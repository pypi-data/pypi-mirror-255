{"HARD": "\nGiven an input question, you should answer the question bycreating a syntactically correct {dialect} query to run.\n\nYou must query only the columns that are needed to answer the question.\n\nAll columns used for selecting or odering must not be null.\n\nWhen asking for patients, you must include uuid_patient, full names, phone number, email address.\n\nThe columns involved in selecting and ordering must be included too.\n\nYou should assume all values in the database are in lowercase.\n\nLimit the number of returning records by the number specified in the question.If the question is about a maximum or a minimum value,do not limit, otherwise limit the number of returning by {max_present}.\n\nWrap each column name in double quotes (\") to denote them as delimited identifiers. You should reply with a syntactically correct {dialect} query only.\n\nThe schema of the database is:\n{table_info}\n", "SOFT": "Pay attention to use only the column names you can see in the tables below. Be careful to not query for columns that do not exist. Also, pay attention to which column is in which table. Pay attention to use CURRENT_DATE function to get the current date, if the question involves \"today\".\nYou should add explicit type casts when needed, such as 'percentile_cont(0.25) WITHIN GROUP (ORDER BY price)::numeric'", "INCONTEXT": [{"request": "give me a list of patients with lowest mmse", "answer": "\nSELECT \"uuid_patient\",\"patient_code\",\"patient_first_name\", \"patient_last_name\",\"patient_mmse_score\",array_agg(\"phones\") FILTER (WHERE phones <> '{{}}') AS \"phones\",array_agg(\"patient_email\") AS \"patient_emails\",array_agg(\"patient_visit_companion_phone\") AS \"patient_visit_companion_phones\",array_agg(\"patient_visit_companion_email\") AS \"patient_visit_companion_emails\"\nFROM tb_patient\nINNER JOIN tb_patient_mmse_and_moca_scores\nON tb_patient.uuid_patient = tb_patient_mmse_and_moca_scores.patient\nWHERE \"patient_mmse_score\" IS NOT null\nGROUP by \"uuid_patient\", \"patient_code\",\"patient_first_name\",\"patient_last_name\", \"patient_mmse_score\"\nORDER BY \"patient_mmse_score\" ASC\nLIMIT 500;\n"}, {"request": "give me a list of overweight patients who toke donezepil", "answer": "\nSELECT \"uuid_patient\",\"patient_code\", \"patient_first_name\",\"patient_last_name\",array_agg(\"phones\") FILTER (WHERE phones <> '{{}}') AS \"phones\",array_agg(\"patient_email\") AS \"patient_emails\",array_agg(\"patient_visit_companion_phone\") AS \"patient_visit_companion_phones\",array_agg(\"patient_visit_companion_email\") AS \"patient_visit_companion_emails\",array_agg(\"patient_treatment\") AS \"patient_treatments\",array_agg(\"medication_name\") AS \"medication_names\",array_agg(\"patient_bmi\") AS \"patient_bmi\"\nFROM tb_patient\nINNER JOIN tb_patient_medications\nON tb_patient.uuid_patient = tb_patient_medications.patient\nWHERE (\"medication_name\" SIMILAR TO '%don(e|\u00e9)p(e|\u00e9)zil%'\nOR \"patient_treatment\" SIMILAR TO '%don(e|\u00e9)p(e|\u00e9)zil%')\nAND \"patient_bmi\" IS NOT NULL\nAND \"patient_bmi\" > 25\nGROUP by \"uuid_patient\", \"patient_code\",\"patient_first_name\",\"patient_last_name\"\nLIMIT 500;\n"}, {"request": "Show me the oldest 3 person who used memantine with valid contact", "answer": "\nSELECT \"uuid_patient\",\"patient_code\", \"patient_first_name\", \"patient_last_name\", \"patient_birth_date\", array_agg(\"phones\") FILTER (WHERE phones <> '{{}}') AS \"phones\",array_agg(\"patient_email\") AS \"patient_emails\",array_agg(\"patient_visit_companion_phone\") AS \"patient_visit_companion_phones\",array_agg(\"patient_visit_companion_email\") AS \"patient_visit_companion_emails\",array_agg(\"patient_treatment\") AS \"patient_treatments\", array_agg(\"medication_name\") AS \"medication_names\"\nFROM tb_patient\nINNER JOIN tb_patient_medications\nON tb_patient.uuid_patient = tb_patient_medications.patient\nWHERE (\"medication_name\" SIMILAR TO '%m(e|\u00e9)mantine%'\nOR \"patient_treatment\" SIMILAR TO '%m(e|\u00e9)mantine%')\nAND (array_length(\"phones\", 1) > 0 OR \"patient_email\" IS NOT NULL OR \"patient_visit_companion_phone\" IS NOT NULL OR \"patient_visit_companion_email\" IS NOT NULL)\nAND \"patient_birth_date\" IS NOT null\nGROUP BY \"uuid_patient\", \"patient_first_name\", \"patient_last_name\", \"patient_code\", \"patient_birth_date\"\nORDER BY \"patient_birth_date\" ASC\nLIMIT 3;\n"}, {"request": "is the patient suzanne allergic to anything?", "answer": "\nSELECT ARRAY_AGG(a.allergy_name) AS allergy_names, p.patient_first_name, p.patient_last_name\nFROM tb_allergies a\nJOIN tb_patients_allergies pa ON a.uuid_allergy = pa.allergy\nJOIN tb_patient p ON pa.patient = p.uuid_patient\nWHERE p.patient_first_name = 'suzanne' OR p.patient_last_name = 'suzanne'\nGROUP BY p.uuid_patient;\n"}, {"request": "Frequencies for patients ages in bins (range of 2), put patients younger than 40 in one bin", "answer": "SELECT count(*) AS frequency, age_range\nFROM (\n    SELECT \n        CASE \n            WHEN extract(year FROM age(current_date, patient_birth_date)) <= 40 THEN '0-40' \n            ELSE concat(floor((extract(year FROM age(current_date, patient_birth_date)) - 40) / 2) * 2 + 41, '-', floor((extract(year FROM age(current_date, patient_birth_date)) - 40) / 2) * 2 + 42) \n        END AS age_range,\n        CASE \n            WHEN extract(year FROM age(current_date, patient_birth_date)) <= 40 THEN 0 \n            ELSE floor((extract(year FROM age(current_date, patient_birth_date)) - 40) / 2) * 2 + 41\n        END AS age_order \n    FROM tb_patient\n) AS subquery\nGROUP BY age_range, age_order\nORDER BY age_order;\n"}], "FORMAT": {"request": {"type": "INPUT", "explanation": "user's request"}, "answer": {"type": "OUTPUT", "explanation": "the {dialect} query you created"}}}