var wt=Object.defineProperty;var bt=(r,t,e)=>t in r?wt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var se=(r,t,e)=>(bt(r,typeof t!="symbol"?t+"":t,e),e);import{d as A,f as T,B as b,C as me,D as J,E as g,G as a,c as D,H as I,a as w,w as ae,F as H,I as Y,z as x,J as G,K as F,L as R,M as tt,N as L,O as kt,P as St,Q as X,R as ee,S as Me,T as at,U as ve,V as Z,W as $t,X as Q,Y as Ee,Z as Ae,o as ke,_ as $e,$ as Ct,n as Dt,a0 as xt,a1 as Tt,a2 as je,a3 as Ke,a4 as It}from"./@vue-ARJAP0c6.js";import{d as Oe,c as Pt}from"./pinia-NPjcYBvE.js";import{u as fe,a as nt,c as Ut,b as Lt}from"./vue-router-pjXNKIxU.js";import{f as ot}from"./fast-xml-parser-AryUhA7v.js";import{P as qe}from"./plotly.js-dist-s6nuoKOE.js";import{y as Bt,N as At}from"./md-editor-v3-MxYz4K4Q.js";import"./@lezer-zO5nUykE.js";import{M as qt}from"./markdown-it-ntFE7Hz2.js";import"./strnum-nO6OuMXP.js";import"./copy-to-clipboard-ebbzfRrE.js";import"./toggle-selection-fekekO1r.js";import"./@vavt-nbmepBNB.js";import"./codemirror-thLcTxEQ.js";import"./@codemirror-1Oy-9S_E.js";import"./style-mod-z-g5kJ9M.js";import"./w3c-keyname-KjuS0gPF.js";import"./medium-zoom-UI1A0slP.js";import"./markdown-it-image-figures-56d0Cn7e.js";import"./markdown-it-task-lists-ssNXB4M9.js";import"./punycode-HZlgMKS9.js";import"./mdurl-FMX-Vhbw.js";import"./uc.micro-ACIubxMQ.js";import"./entities-Magy3A7t.js";import"./linkify-it-YB6gZgM7.js";import"./punycode.js-rvxP7Hxc.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function e(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=e(o);fetch(o.href,l)}})();const Rt=A({__name:"Popup",props:{styleType:{default:"info"},position:{default:"top-center"}},setup(r){const t=r,e=T(()=>t.styleType==="alert"||t.styleType==="error"?{backgroundColor:"rgba(180, 0, 20, 0.9)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="warning"?{backgroundColor:"rgba(210, 150, 0, 0.9)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="info"?{backgroundColor:"rgba(0, 0, 0, 0.75)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="success"?{backgroundColor:"rgba(0, 180, 0, 0.9)",color:"rgba(255, 255, 255, 1)"}:{backgroundColor:"rgba(0, 0, 0, 0.5)",color:"var(--color-text)"}),n=T(()=>{if(t.position==="top-center")return{top:"30px",left:"50%",transform:"translate(-50%, 0)"};if(t.position==="center")return{top:"50%",left:"50%",transform:"translate(-50%, -50%)"};throw Error("Incorrect style.")});return(o,l)=>(g(),b("div",{id:"popup",style:J({...e.value,...n.value})},[me(o.$slots,"default",{},void 0,!0)],4))}}),E=(r,t)=>{const e=r.__vccOpts||r;for(const[n,o]of t)e[n]=o;return e},Ge=E(Rt,[["__scopeId","data-v-e0ba6b84"]]);let Mt=window.location.protocol,st;st=`${Mt}//${window.location.hostname}:${window.location.port}`;const Et=`${st}/docs/userManual_zh/index.html`;console.log("production mode");function te(){const r=V().backendPort;return`${V().backendHost}:${r}`}const Ot={name:"Li, Mengxun",email:"mengxunli@whu.edu.cn"},Ie=["SweetiePie","CutiePatootie","CuddleBug","FluffyPaws","HoneyBee","SnuggleMuffin","SugarPlum","AngelFace","PawsomePuppy","TeddyBearHugs","PrettyKitty","LoveBug","BabyDoll","SunshineSmiles","FuzzyWuzzy","BumbleBee","CupcakeQueen","DoodleDaisy","PurrfectPaws","CuddlyKoala","SweetPea","BunnyHop","SparklePony","HappyPanda","DreamyDove","FluffyCloud","CherryBlossom","AngelicWhisper","SnickerDoodle","LuckyLadybug","BlossomButterfly","SugarCubes","CottonCandyDreams","HoneyBunches","FurryFriend","BabyBlueEyes","SweetCheeks","PawsitiveVibes","SnugglyBear","LovelyLlama","PurrfectlyAdorable","TwinkleToes","CuddleBunny","CookieCrumbs","SunnySmiles","FluffyKitten","DarlingDeer","ButterflyKisses","FuzzyWuzzyPanda","SweetDreamer","SillyGoose","DaisyDoodle","CupcakeCutie","BuzzyBee","SnoozySnail","CharmingChick","CandyCane","BerryBlossom","Dimples","CocoaCuddles","CheerfulCherub","PetalPaws","BubblyBumble","AngelWings","JollyJellybean","WhiskerWonder","SprinkleSmiles","GigglyGiraffe","DancingDaisy","SunnySideUp","SnugglySloth","CuteQuokka","PeachyPaws","BouncyBunny","DazzlingDimples","ChirpyChickadee","CandyHeart","CupcakeSprinkle","BuzzyButterfly","SnoozyPanda","CharmingCorgi","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy","ChirpyChickadee","CandyCane","CupcakeCutie","BuzzyButterfly","SnoozySnail","CharmingCherub","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy"];var ue=function r(t){function e(de,N){return de>>>N|de<<32-N}for(var n=Math.pow,o=n(2,32),l="length",s,d,i="",p=[],y=t[l]*8,c=r.h=r.h||[],u=r.k=r.k||[],m=u[l],h={},f=2;m<64;f++)if(!h[f]){for(s=0;s<313;s+=f)h[s]=f;c[m]=n(f,.5)*o|0,u[m++]=n(f,1/3)*o|0}for(t+="";t[l]%64-56;)t+="\0";for(s=0;s<t[l];s++){if(d=t.charCodeAt(s),d>>8)throw new Error("ASCII check failed");p[s>>2]|=d<<(3-s)%4*8}for(p[p[l]]=y/o|0,p[p[l]]=y,d=0;d<p[l];){var v=p.slice(d,d+=16),_=c;for(c=c.slice(0,8),s=0;s<64;s++){var k=v[s-15],S=v[s-2],C=c[0],$=c[4],U=c[7]+(e($,6)^e($,11)^e($,25))+($&c[5]^~$&c[6])+u[s]+(v[s]=s<16?v[s]:v[s-16]+(e(k,7)^e(k,18)^k>>>3)+v[s-7]+(e(S,17)^e(S,19)^S>>>10)|0),B=(e(C,2)^e(C,13)^e(C,22))+(C&c[1]^C&c[2]^c[1]&c[2]);c=[U+B|0].concat(c),c[4]=c[4]+U|0}for(s=0;s<8;s++)c[s]=c[s]+_[s]|0}for(s=0;s<8;s++)for(d=3;d+1;d--){var j=c[s]>>d*8&255;i+=(j<16?0:"")+j.toString(16)}return i};class zt{constructor(){this._baseUrlGetter=()=>"",this._tokenGetter=()=>""}setBaseUrlGetter(t){this._baseUrlGetter=t}setCredentialGetter(t){this._tokenGetter=t}async get(t,e={}){const n=new URL(`${this._baseUrlGetter()}${t}`);return Object.keys(e).forEach(o=>n.searchParams.append(o,e[o])),await this._fetch(n.toString(),{method:"GET"})}async post(t,e={}){const n=new FormData;for(const o in e)n.append(o,e[o]);return await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"POST",body:n})}async put(t,e){const n=new FormData;return n.append("key",this._tokenGetter()),n.append("file",e),await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"PUT",body:n})}async delete(t){const e=new FormData;return e.append("key",this._tokenGetter()),await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"DELETE",body:e})}async _fetch(t,e){if((e==null?void 0:e.method)==="GET"&&(t+=t.includes("?")?"&":"?",t+=`key=${this._tokenGetter()}`),(e==null?void 0:e.method)==="POST"||(e==null?void 0:e.method)==="PUT"||(e==null?void 0:e.method)==="DELETE")if(e.body===void 0)e.body=JSON.stringify({key:this._tokenGetter()});else if(typeof e.body=="string")e.body=JSON.stringify({key:this._tokenGetter(),...JSON.parse(e.body)});else if(e.body instanceof FormData)e.body.has("key")||e.body.append("key",this._tokenGetter());else throw new Error("Not implemented body type");const n=await fetch(t,e);if(!n.ok)throw new Error(`Request failed with status ${n.status}`);return n}}class q{constructor(){this.fetcher=new zt,this.fetcher.setBaseUrlGetter(()=>`${te()}`),this.fetcher.setCredentialGetter(()=>V().encKey)}get settings(){return V()}apiURL(){return te()+"/api"}async authUsr(t){return await this.fetcher.post("/api/auth",{key:t}).then(e=>e.json())}async status(){return await this.fetcher.get("/api/status").then(t=>t.json())}async reqFileList(t){return await this.fetcher.get("/api/filelist",{tags:t.join("&&")}).then(e=>e.json())}async reqFileListStream(t=[],e=()=>{}){const n=await this.fetcher.get("/api/filelist-stream",{tags:t.join("&&")}),o=n.headers.get("totalDataCount"),l=o?parseInt(o):-1;let s=0;const d=n.body.getReader();let i="";const p=({value:y,done:c})=>{const m=(i+new TextDecoder().decode(y)).split("\\N");for(let h=0;h<m.length-1;h++){const f=m[h];try{const v=JSON.parse(f);s+=1,e(v,s,l)}catch(v){console.error(v)}}if(m.length>0&&(i=m[m.length-1]),c){if(i)try{const h=JSON.parse(i);s+=1,e(h,s,l)}catch(h){console.error(h)}return}return d.read().then(p)};return d.read().then(p)}async reqDatabaseFeatureTSNE(t="doc_feature",e=3,n=10){return await this.fetcher.get(`/api/datafeat/tsne/${t}`,{n_component:e.toString(),perplexity:n.toString()}).then(o=>o.json())}async reqDatapointSummary(t){return await this.fetcher.get(`/api/fileinfo/${t}`).then(e=>e.json())}async reqReloadDB(){return await this.fetcher.post("/api/reload-db").then(t=>!0)}async reqDatapointAbstract(t){return await this.fetcher.get(`/api/fileinfo-supp/abstract/${t}`).then(e=>e.text())}async reqDatapointAbstractUpdate(t,e){return await this.fetcher.post(`/api/fileinfo-supp/abstract-update/${t}`,{content:e}).then(n=>!0)}async reqDatapointNote(t){return await this.fetcher.get(`/api/fileinfo-supp/note/${t}`).then(e=>e.text())}async reqDatapointNoteUpdate(t,e){return await this.fetcher.post(`/api/fileinfo-supp/note-update/${t}`,{content:e}).then(n=>!0)}async search(t,e){return await this.fetcher.post("/api/search",{method:t,kwargs:JSON.stringify(e)}).then(n=>n.json())}async featurize(t,e=!1){return await this.fetcher.post("/api/iserver/textFeature",{text:t,require_cache:e}).then(n=>n.json())}reqAISummary(t,e,n=()=>{},o=!0,l="DEFAULT"){this.fetcher.post("/api/summary",{force:o,uuid:t,model:l}).then(s=>{if(!s.ok)throw e("(Error: "+s.status+")"),new Error("HTTP error "+s.status);const d=s.body.getReader(),i=({value:p,done:y})=>{if(y){n();return}let c=new TextDecoder().decode(p);return e(c),d.read().then(i)};return d.read().then(i)})}async deleteData(t){return await this.fetcher.post("/api/dataman/delete",{uuid:t}).then(()=>!0)}async editData(t,e=null,n=null,o=null){if(!t&&(e===null||n===null||o===null))throw new Error("uid is null, other fields should be complete");const l={};return t!==null&&(l.uuid=JSON.stringify(t)),e!==null&&(l.bibtex=e),n!==null&&(l.tags=JSON.stringify(n)),o!==null&&(l.url=o),await this.fetcher.post("/api/dataman/update",l).then(s=>s.json())}async uploadImages(t,e){return(await Promise.all(e.map(o=>new Promise((l,s)=>{this.fetcher.put(`/img/${t}`,o).then(d=>d.json()).then(l).catch(s)})))).map(o=>o.file_name)}async uploadDocument(t,e){return await this.fetcher.put(`/doc/${t}`,e).then(n=>n.json())}async freeDocument(t){return await this.fetcher.delete(`/doc/${t}`).then(e=>e.json())}async renameTag(t,e){return await this.fetcher.post("/api/dataman/tag-rename",{oldTag:t,newTag:e}).then(()=>!0)}async deleteTag(t){return await this.fetcher.post("/api/dataman/tag-delete",{tag:t}).then(()=>!0)}async reqUserInfo(t){return await this.fetcher.post(`/api/user/info/${t}`).then(e=>e.json())}async updateUserNickname(t){return await this.fetcher.post("/api/user/info-update",{name:t}).then(e=>e.json())}async updateUserPassword(t){return await this.fetcher.post("/api/user/info-update",{password:ue(t)}).then(e=>e.json())}async reqUserList(){return await this.fetcher.post("/api/user/list",{}).then(t=>t.json())}async uploadUserAvatar(t,e){return await this.fetcher.put(`/user-avatar/${t}`,e).then(n=>n.json())}async setUserAccess(t,e,n){const o={};return o.username=t,e!==null&&(o.is_admin=e.toString()),n!==null&&(o.mandatory_tags=JSON.stringify(n)),await this.fetcher.post("/api/userman/modify",o).then(l=>l.json())}async createUser(t,e,n,o,l){return await this.fetcher.post("/api/userman/create",{username:t,name:e,password:ue(n),is_admin:o.toString(),mandatory_tags:JSON.stringify(l)}).then(s=>s.json())}async deleteUser(t){return await this.fetcher.post("/api/userman/delete",{username:t}).then(()=>!0)}async changelog(){return await this.fetcher.get("/api/info/changelog").then(t=>t.json())}}const oe="->";class O extends Set{static removeSpaces(t){const e=t.split(oe);for(let n=0;n<e.length;n++)e[n]=e[n].trim();return t=e.join(oe),t}constructor(t=null){t===null&&(t=[]);const e=t instanceof Set?t:new Set(t);e.forEach(n=>O.removeSpaces(n)),super(e)}copy(){return new O(this)}add(t){return super.add(O.removeSpaces(t))}has(t){return super.has(O.removeSpaces(t))}union(t){const e=new O(this);return e.union_(t),e}union_(t){return t.forEach(e=>this.add(e)),this}pop(t){const e=new O(this);return e.pop_(t),e}pop_(t){return t.forEach(e=>this.delete(e)),this}pop_ifcontains_(t){return t.forEach(e=>{this.has(e)&&this.delete(e)}),this}issubset(t){return _e.isSubset(this,t)}withParents(){const t=new O(this);return this.forEach(e=>t.union_(_e.allParentsOf(e))),t}withChildsFrom(t){const e=new O(this);return this.forEach(n=>e.union_(_e.allChildsOf(n,t))),e}allParents(){const t=new O;return this.forEach(e=>t.union_(_e.allParentsOf(e))),t}toArray(){return Array.from(this)}}class _e{static allParentsOf(t){const e=t.split(oe);if(e.length===1)return new O([]);const n=[],o=[];for(let l=0;l<e.length-1;l++)n.push(e[l]),o.push(n.join(oe));return new O(o)}static allChildsOf(t,e){const n=new O;for(const o of e)o.startsWith(t)&&o.length>t.length+oe.length&&o.substring(t.length,t.length+oe.length)===`${oe}`&&n.add(o);return n}static tagHierarchy(t){const e=oe;function n(s,d){const i=s.split(d);return i.length===1?[s]:[i[0],i.slice(1).join(d)]}function o(s,d=e){const i={},p=s.map(c=>n(c,d));for(const c of p)c[0]in i||(i[c[0]]=[]),c.length===2&&i[c[0]].push(c[1]);const y={};for(const c in i)y[c]=o(i[c],d);return y}function l(s,d=e){for(const i in s){const p=s[i];for(const y in p){const c=[i,y].join(e);p[c]=p[y],delete p[y]}l(p,d)}return s}return l(o(Array.from(t)))}static isSubset(t,e){let n=!0;for(const o of t)if(!e.has(o)){n=!1;break}return n}}function Qe(){return`${te()}/api`}class Je{constructor(t){se(this,"summary");se(this,"supp");this.summary=t,this.supp={note:null,abstract:null}}get tags(){return new O(this.summary.tags)}toString(){return`${this.summary.title} - ${this.authorAbbr()} (${this.summary.year}) [uid: ${this.summary.uuid}]`}fetchAbstract(){return new Promise((t,e)=>{new q().reqDatapointAbstract(this.summary.uuid).then(n=>{this.supp.abstract=n,t(n)}).catch(n=>{e(n)})})}uploadAbstract(t){return new Promise((e,n)=>{if(t===this.supp.abstract||t===null){e(!0);return}new q().reqDatapointAbstractUpdate(this.summary.uuid,t).then(o=>{this.supp.abstract=t,e(o)}).catch(o=>{n(o)})})}fetchNote(){return new Promise((t,e)=>{new q().reqDatapointNote(this.summary.uuid).then(n=>{this.supp.note=n,t(n)}).catch(n=>{e(n)})})}uploadNote(t){return t===null?Promise.reject("Note is null"):(t=t.replace(new RegExp(`${te()}/img/${this.summary.uuid}\\?fname=`,"g"),"./misc/"),new Promise((e,n)=>{new q().reqDatapointNoteUpdate(this.summary.uuid,t).then(o=>{this.supp.note=t,this.summary.note_linecount=t.split(`
`).map(l=>l.trim()==""?0:1).reduce((l,s)=>l+s,0),e(o)}).catch(o=>{n(o)})}))}uploadImages(t){return new Promise((e,n)=>{new q().uploadImages(this.summary.uuid,t).then(o=>{e(o.map(l=>`./misc/${l}`))},o=>{n(o)})})}uploadDocument(t){return new q().uploadDocument(this.summary.uuid,t)}freeDocument(){return new q().freeDocument(this.summary.uuid)}update(t=null){if(t!==null)return this.summary=t,Promise.resolve(t);const e=new q().reqDatapointSummary(this.summary.uuid);return e.then(n=>{this.summary=n}),e}destory(){this.summary=Re}authorAbbr(){let t="";return this.summary.authors.length>1&&(t=" et al."),this.summary.authors[0]+t}authorYear(){return`${this.authorAbbr()} ${this.summary.year}`}yearAuthor(t=" "){return`${this.summary.year}${t}${this.authorAbbr()}`}isDummy(){return this.summary.uuid===Re.uuid}getRawDocURL(){const t=this.summary.uuid;return this.summary.has_file&&this.summary.file_type==".pdf"?`${te()}/doc/${t}`:!this.summary.has_file&&this.summary.url?this.summary.url:"about:blank"}getOpenDocURL({extraPDFViewerParams:t={},urlHashMark:e=""}={}){const n=this.summary.uuid,o=`${te()}/pdfjs/web/viewer.html`;function l(i,p=o){const y=new URLSearchParams;p===o&&y.append("key",V().encKey),y.append("file",`${i}`);for(const c in t)y.append(c,t[c]);return`${p}?${y.toString()}`}function s(i){return e?(new URL(i).hash&&(i=i.slice(0,i.indexOf("#"))),`${i}#${e}`):i}let d="about:blank";if(this.isDummy()&&(d="about:blank"),this.summary.has_file&&this.summary.file_type==".pdf"){const i=`${te()}/doc/${n}`;d=l(s(i))}return!this.summary.has_file&&this.summary.url&&(d=s(this.summary.url)),console.log("Open doc url: ",d),d}getOpenNoteURL(){const t=this.summary.uuid;return`${Qe()}/comment/${t}/`}getOpenSummaryURL(){const t=this.summary.uuid;return`${Qe()}/summary?uuid=${t}&key=${V().encKey}`}docType(){return this.summary.has_file&&this.summary.file_type==".pdf"?"pdf":!this.summary.has_file&&this.summary.url?"url":!this.summary.has_file&&!this.summary.url?"":"unknown"}}const Re={has_file:!1,file_type:"",year:"0000",title:" ",author:" ",authors:[" "],publication:null,tags:[],uuid:" ",url:"about:blank",time_added:0,time_modified:0,bibtex:"",doc_size:0,note_linecount:0,has_abstract:!1};class Ft{constructor(){se(this,"data");se(this,"_initliazed");this.data={},this._initliazed=!1}get initialized(){return this._initliazed}*[Symbol.iterator](){for(let t in this.data)yield this.data[t]}async requestData(){const e=await new q().reqFileList([]);console.log("Get infolist of size: ",(JSON.stringify(e).length*2/1024/1024).toPrecision(2),"MB"),this.clear();for(let n of e)this.add(n);this._initliazed=!0}async requestDataStream(t=()=>{}){const e=new q;this.clear(),await e.reqFileListStream([],(n,o,l)=>{this.add(n),t(o,l)}),console.log("Get datapoints of size: ",(JSON.stringify(this.data).length*2/1024/1024).toPrecision(2),"MB"),this._initliazed=!0}add(t){return this.data[t.uuid]=new Je(t),this.data[t.uuid]}clear(){this.data={},this._initliazed=!1}delete(t){delete this.data[t]}get(t){return t in this.data?this.data[t]:new Je(Re)}async aget(t){throw new Error("Not implemented")}getMany(t){const e=[];for(const n of t)e.push(this.get(n));return e}getAllTags(){let t,e=new Set;for(const n of this){t=n.summary.tags;for(const o of t)e.add(o)}return new O(e)}getDataByTags(t){t=new O(t);const e=[];for(const n in this.data){const o=this.data[n],l=new O(o.summary.tags);t.issubset(l.withParents())&&e.push(o)}return e}async renameTag(t,e){if(t=O.removeSpaces(t),e=O.removeSpaces(e),await new q().renameTag(t,e)){const l=this.getDataByTags([t]);return(await Promise.all(l.map(d=>d.update()))).every(d=>d)}else return!1}async deleteTag(t){if(t=O.removeSpaces(t),await new q().deleteTag(t)){const o=this.getDataByTags([t]);return(await Promise.all(o.map(s=>s.update()))).every(s=>s)}else return!1}}class ze{static async filter(t,e){const n=e.content.toLowerCase();if(!n)return{datapoints:this.sortDefault(t,!1),scores:null};const o=new Set;for(const s of t)o.add(s.summary.uuid);const l=new Array;if(e.searchBy.toLowerCase()==="feature"){const d=await new q().search("searchFeature",{pattern:e.content,n_return:999}),i=new Array;for(const y of t)if(d[y.summary.uuid]){l.push(y);const c=d[y.summary.uuid].score;i.push(c)}const p=this.sortByScore(l,i,!1);return{datapoints:p[0],scores:p[1]}}else if(e.searchBy.toLowerCase()==="note"){const d=await new q().search("searchNote",{pattern:e.content,ignore_case:!0}),i=Object.keys(d);for(const p of t)i.includes(p.summary.uuid)&&l.push(p);return{datapoints:this.sortDefault(l,!1),scores:null}}else if(e.searchBy.toLowerCase()==="title")for(const s of t)s.summary.title.toLowerCase().search(n)!==-1&&l.push(s);else if(e.searchBy.toLowerCase()==="uuid")for(const s of t)s.summary.uuid.toLowerCase().search(n)!==-1&&l.push(s);else if(e.searchBy.toLowerCase()==="author"){const s=W().authorPublicationMap,d=be(e.content);if(d in s)for(const i of s[d])o.has(i.summary.uuid)&&l.push(i);else for(const i in s)if(i.search(d)!==-1)for(const p of s[i])o.has(p.summary.uuid)&&l.push(p)}else if(e.searchBy.toLowerCase()==="publication")for(const s of t)s.summary.publication&&s.summary.publication.toLowerCase().search(n)!==-1&&l.push(s);else if(e.searchBy.toLowerCase()==="general")for(const s of t)`${s.summary.title}|${s.summary.authors.join(", ")}|${s.summary.year}`.toLowerCase().search(n)!==-1&&l.push(s);else throw new Error("Unknown searchBy option");return{datapoints:this.sortDefault(l,!1),scores:null}}static sortDefault(t,e=!1){return e?t.sort((n,o)=>n.summary.time_added-o.summary.time_added):t.sort((n,o)=>o.summary.time_added-n.summary.time_added)}static sortByScore(t,e,n=!1){if(t.length!==e.length)throw new Error("arr.length !== scores.length");const o=new Array;for(let i=0;i<t.length;i++)o.push([t[i],e[i]]);let l;n?l=o.sort((i,p)=>i[1]-p[1]):l=o.sort((i,p)=>p[1]-i[1]);const s=new Array,d=new Array;for(const i of l)s.push(i[0]),d.push(i[1]);return[s,d]}}function be(r){r=r.trim().toLowerCase().replace(/-/g,"");let t=r.trim();if(t.includes(",")){const[e,n]=t.split(",",2);t=`${e.trim()}, ${n.trim()}`}else{if(t.indexOf(" ")===-1)return t;const e=t.lastIndexOf(" "),n=t.slice(e+1),o=t.slice(0,e);t=`${n.trim()}, ${o.trim()}`}return t}async function Nt(r){if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(r),!0;{const t=document.createElement("textarea");t.value=r,t.style.position="absolute",t.style.left="-99999999px",document.body.prepend(t),t.select();let e=!1;try{document.execCommand("copy")}catch(n){console.log(n),e=!0}finally{t.remove()}return!e}}function Pe(r){window.open(r,"_blank")}function rt(r,t){let e=null;return function(...n){e&&window.clearTimeout(e),e=window.setTimeout(()=>{r(...n),e=null},t)}}const M=Oe("uiStatus",{state:()=>({tagStatus:{checked:new O,all:new O,unfolded:new O},shownDataUIDs:[],shownDataScores:[],searchState:{searchBy:"",content:""},unfoldedDataUIDs:[],recentlyReadDataUIDs:[],preferredReaderLeftPanelWidthPerc:.65,popupValues:{},databaseLoadingStatus:{nCurrent:0,nTotal:-1}}),getters:{databaseLoadingProgress(){return this.databaseLoadingStatus.nTotal===-1?this.databaseLoadingStatus.nCurrent===0?0:1:this.databaseLoadingStatus.nCurrent/this.databaseLoadingStatus.nTotal}},actions:{updateShownData(){const r=W();this.tagStatus.all=r.allTags;const t=r.database.getDataByTags(this.tagStatus.checked);ze.filter(t,this.searchState).then(e=>{this.shownDataUIDs=e.datapoints.map(n=>n.summary.uuid),this.shownDataScores=e.scores})},addRecentlyReadDataUID(r){W().database.get(r).isDummy()||(this.recentlyReadDataUIDs.includes(r)&&this.recentlyReadDataUIDs.splice(this.recentlyReadDataUIDs.indexOf(r),1),this.recentlyReadDataUIDs.unshift(r),this.recentlyReadDataUIDs.length>5&&this.recentlyReadDataUIDs.pop())},showPopup(r,t="info",e=3e3){const n=Math.random().toString();this.popupValues[n]={content:r,styleType:t},setTimeout(()=>{delete this.popupValues[n]},e)},reloadDatabase(r=!1){W().reload(r,()=>{this.databaseLoadingStatus.nCurrent=0,W().database.clear(),this.updateShownData()},()=>{this.updateShownData(),M().databaseLoadingStatus.nTotal=-1},()=>{this.showPopup(`Failed to load database from: ${new q().apiURL()}`,"alert"),M().databaseLoadingStatus.nTotal=-1},(t,e)=>{this.databaseLoadingStatus.nCurrent=t,this.databaseLoadingStatus.nTotal=e})}}}),W=Oe("data",{state:()=>({database:new Ft,user:{id:-1,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1}}),getters:{authorPublicationMap(){const r={};console.log("Generating authorPublicationMap...");for(const t of this.database)for(let e of t.summary.authors)e=be(e),e in r||(r[e]=[]),r[e].push(t);return r},allTags(){return this.database.getAllTags()}},actions:{clearUserInfo(){this.user={id:0,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1}},reload(r=!1,t=()=>{this.database.clear()},e=()=>{},n=()=>{},o=()=>{}){t();function l(s){s.database.requestDataStream(o).then(d=>{e()},d=>{n(d)})}r?new q().reqReloadDB().then(s=>{console.log("Reload: ",s),s?l(this):n(new Error("Failed to reload database from backend"))},s=>{n(s)}):l(this)}}}),V=Oe("settings",{state:()=>({__encKey:sessionStorage.getItem("encKey")||localStorage.getItem("encKey")||"",__showTagPanel:(localStorage.getItem("showTagPanel")||"true")==="true",__show3DScatterPlot:(localStorage.getItem("show3DScatterPlot")||"false")==="true",__readerLayoutType:localStorage.getItem("readerLayoutType")||"2",__backendHost:sessionStorage.getItem("backendUrl")||Ht(),__backendPort:sessionStorage.getItem("backendPort")||Wt(),loggedIn:!1}),getters:{encKey(){return this.__encKey},backendHost(){return this.__backendHost},backendPort(){return this.__backendPort},showTagPanel(){return this.__showTagPanel},show3DScatterPlot(){return this.__show3DScatterPlot},readerLayoutType(){return parseInt(this.__readerLayoutType)}},actions:{setEncKey(r,t){this.__encKey=r,t===!0?localStorage.setItem("encKey",r):(localStorage.getItem("encKey")&&localStorage.removeItem("encKey"),sessionStorage.setItem("encKey",r))},setBackendHost(r){this.__backendHost=r,sessionStorage.setItem("backendUrl",r)},setBackendPort(r){this.__backendPort=r,sessionStorage.setItem("backendPort",r)},setShowTagPanel(r){this.__showTagPanel=r,localStorage.setItem("showTagPanel",r.toString())},setShow3DScatterPlot(r){this.__show3DScatterPlot=r,localStorage.setItem("show3DScatterPlot",r.toString())},setReaderLayoutType(r){this.__readerLayoutType=r.toString(),localStorage.setItem("readerLayoutType",r.toString())}}});function Ht(){let r=window.location.protocol,t=window.location.hostname;return`${r}//${t}`}function Wt(){const r=window.location.port;return r==="1420"?"8080":r}function Fe(r,t,e){V().setEncKey(r,e),t!==null?W().user=t:W().clearUserInfo(),t?V().loggedIn=!0:V().loggedIn=!1}function Zt(){Fe("",null,!0)}async function Vt(){const r=new q,t=V().encKey;try{const e=await r.authUsr(t);return Fe(t,e,!0),e}catch(e){return console.log("settingsAuthentication failed: ",e),null}}function jt(r,t){return ue(r+ue(t))}const we={};window.g_eventHooks=we;function ne(r,t){if(Array.isArray(r)){for(const e of r)ne(e,t);return}we[r]===void 0&&(we[r]=[]),we[r].push(t)}function Ue(){return window.g_wsConn===void 0&&(window.g_wsConn=new Kt),window.g_wsConn}class Kt{constructor(){se(this,"resetRemainingRetries",()=>{this.__remainingRetries=10});se(this,"decreaseRemainingRetries",()=>{this.__remainingRetries-=1});se(this,"isOpen",()=>this.ws?this.ws.readyState===WebSocket.OPEN:!1);se(this,"willTryReconnect",()=>this.__remainingRetries>0);this.resetRemainingRetries(),this.sessionID=ue(Date.now().toString()).slice(0,16),this.__eventCallback_records={onopenCallback:()=>{},onmessageCallback:t=>{},oncloseCallback:()=>{},onfailedToConnectCallback:()=>{}}}get settings(){return V()}init({onopenCallback:t=()=>{},onmessageCallback:e=l=>{},oncloseCallback:n=()=>{},onfailedToConnectCallback:o=()=>{}}={}){this.__eventCallback_records={onopenCallback:t,onmessageCallback:e,oncloseCallback:n,onfailedToConnectCallback:o};const l=new URLSearchParams(window.location.search);l.append("key",this.settings.encKey),l.append("session_id",this.sessionID);const s=te().replace("https://","wss://").replace("http://","ws://")+"/ws?"+l.toString();return console.log("connecting to server websocket at: ",s),this.ws=new WebSocket(s),this.ws.onmessage=d=>{console.log(d);const i=JSON.parse(d.data);if(i.type==="event"){const p=i.content;if(console.log(p),Object.keys(we).includes(p.type))for(const y of we[p.type])y(p)}e(d)},this.ws.onopen=()=>{console.log("connected to server websocket"),t(),this.resetRemainingRetries()},this.ws.onclose=()=>{console.log("server websocket closed, will try to reconnect in 1 second"),n(),this.willTryReconnect()?(this.decreaseRemainingRetries(),new Promise(d=>setTimeout(d,1e3)).then(()=>{this.ws.readyState===WebSocket.CLOSED&&this.init({onopenCallback:t,onmessageCallback:e,oncloseCallback:n,onfailedToConnectCallback:o})})):o()},this}send(t){this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(t)):console.log("server websocket not ready, cannot send data")}reset(){this.ws.readyState===WebSocket.OPEN&&this.ws.close(),this.resetRemainingRetries(),this.init(this.__eventCallback_records)}close(){this.ws.readyState===WebSocket.OPEN?this.ws.close():console.log("server websocket not ready, cannot close")}}const Gt={class:"loading-widget"},Qt=A({__name:"LoadingWidget",props:{size:{default:"40px"},border_width:{default:"5px"}},setup(r){const t=r,e=T(()=>({width:t.size,height:t.size,border:t.border_width+" solid var(--color-border)",borderTopColor:"var(--color-primary)"}));return(n,o)=>(g(),b("div",Gt,[a("div",{class:"loading-widget__spinner",style:J(e.value)},null,4)]))}}),Le=E(Qt,[["__scopeId","data-v-1d6933bb"]]),Jt={class:"loading-popout"},Yt=A({__name:"LoadingPopout",props:{text:{default:"loading"}},setup(r){const t=r;return(e,n)=>(g(),b("div",Jt,[D(Le,{size:"25px"}),a("label",null,I(t.text),1)]))}}),Xt=E(Yt,[["__scopeId","data-v-95a13423"]]),ea=r=>(X("data-v-31782a92"),r=r(),ee(),r),ta={id:"popups"},aa=ea(()=>a("div",null,[a("div",{style:{"font-size":"2em","font-weight":"bold",color:"var(--color-red)"}},"Failed to connect to server"),a("div",{style:{color:"gray"}},"Maximum retry exceeded")],-1)),na={id:"app"},oa=A({__name:"App",setup(r){const t=fe(),e=M(),n=V();t.isReady().then(()=>{if(t.currentRoute.value.query.backendPort&&V().setBackendPort(t.currentRoute.value.query.backendPort),t.currentRoute.value.query.backendHost&&V().setBackendHost(t.currentRoute.value.query.backendHost),t.currentRoute.value.query.credential&&V().setEncKey(t.currentRoute.value.query.credential,!1),window.location.hash.split("?")[0]!=="#/login"){console.log("Authenticating...");const u=()=>{n.loggedIn?n.loggedIn=!1:y()};Vt().then(m=>{m||u()},()=>{u()})}});const o=w(!1),l=w(!1),s=w(window.location.hash.split("?")[0]==="#/login");t.afterEach((u,m)=>{s.value=u.path==="/login"});const d=T(()=>!o.value&&!s.value&&!l.value),i=T(()=>l.value&&!s.value);function p(){console.log("Logged in."),Ue().init({onopenCallback:()=>{o.value=!0,l.value=!1},oncloseCallback:()=>o.value=!1,onfailedToConnectCallback:()=>l.value=!0}),e.reloadDatabase()}function y(){console.log("Logged out from: ",t.currentRoute.value.fullPath),Ue().isOpen()&&Ue().close(),t.push({path:"/login",query:{from:t.currentRoute.value.fullPath}})}ae(()=>n.loggedIn,(u,m)=>{u?p():y()}),ne("add_entry",u=>{const m=W(),h=u.datapoint_summary;m.database.add(h),e.updateShownData()}),ne("update_entry",u=>{var f;const m=W(),h=u.datapoint_summary;(f=m.database.get(h.uuid))==null||f.update(h),e.updateShownData()}),ne("delete_entry",u=>{const m=W(),h=u.uuid;m.database.delete(h),e.updateShownData()}),ne(["delete_tag","update_tag"],u=>{const m=new O([u.src_tag]),f=W().database.getDataByTags(m);Promise.all(f.map(v=>v.update())).then(()=>{e.updateShownData()},()=>{e.showPopup("Tag rename succeded at server side, but faild to fetch update, please reload the page","error")})}),ne("update_user",u=>{if(u.username===W().user.username){if(u.user_info===null)throw new Error("assertion failed: User info is null");for(const m of Object.keys(W().user))m!=="enc_key"&&(W().user[m]=u.user_info[m])}});const c=()=>{window.location.reload()};return(u,m)=>{const h=tt("router-view");return g(),b(H,null,[a("div",ta,[(g(!0),b(H,null,Y(Object.keys(x(e).popupValues),(f,v)=>(g(),G(Ge,{key:v,styleType:x(e).popupValues[f].styleType,style:J({transform:`translate(-50%, ${-50+110*v}%) scale(0.9)`})},{default:R(()=>[L(I(x(e).popupValues[f].content),1)]),_:2},1032,["styleType","style"]))),128))]),d.value?(g(),G(Xt,{key:0,text:"connecting..."})):F("",!0),i.value?(g(),G(Ge,{key:1,styleType:"info",position:"center"},{default:R(()=>[a("div",{style:{display:"flex","flex-direction":"column","align-items":"center",margin:"10px"}},[aa,a("div",{style:{"font-size":"1.2em","margin-top":"10px"}},[L(" Please check if the server is running, make sure your network is working properly, and try to "),a("a",{style:{"text-decoration":"underline",cursor:"pointer"},onClick:c},"reload the page"),L(". ")])])]),_:1})):F("",!0),a("div",na,[D(h,null,{default:R(({Component:f})=>[(g(),G(St,{exclude:"Reader"},[(g(),G(kt(f)))],1024))]),_:1})])],64)}}}),sa=E(oa,[["__scopeId","data-v-31782a92"]]),ra={for:"chk"},la={id:"checkCircle"},ia={key:0,id:"checkStatus"},ua=A({__name:"Toggle",props:{checked:{type:Boolean},identifier:{default:""}},emits:["onCheck"],setup(r,{emit:t}){const e=t,n=r;function o(l){e("onCheck",n.identifier)}return(l,s)=>(g(),b("div",{class:"toggle",onClick:o},[a("label",ra,[me(l.$slots,"default",{},void 0,!0)]),a("div",la,[l.checked?(g(),b("div",ia)):F("",!0)])]))}}),pe=E(ua,[["__scopeId","data-v-582ee950"]]),da={class:"toggleText"},ca={class:"children slideInDown"},pa=A({__name:"TagCollapsibleToggle",props:{tagStatus:{},identifier:{default:""},children:{}},emits:["update:tagStatus"],setup(r,{emit:t}){const e=r,n=t,o=T({get:()=>e.tagStatus,set:h=>n("update:tagStatus",h)}),l=T(()=>{let h="collapseButton";return Object.keys(e.children).length!==0&&(h+=" collapsible"),h}),s=w(null),d=T(()=>!e.tagStatus.unfolded.has(e.identifier)),i=T(()=>d.value?"triangle-right":"triangle-down rotate90in");function p(h){let f=o.value.unfolded;f.has(e.identifier)?f.delete(e.identifier):f.add(e.identifier)}const y=T(()=>e.tagStatus.checked.has(e.identifier));function c(h){if(h===void 0)return;let f=o.value.checked;f.has(h)?f.delete(h):f.add(h)}const u=w(null),m=h=>{h.button===2&&(p(),h.preventDefault())};return Me(()=>{var h;(h=u.value)==null||h.addEventListener("contextmenu",m)}),at(()=>{var h;(h=u.value)==null||h.removeEventListener("contextmenu",m)}),(h,f)=>(g(),b(H,null,[a("div",{class:"row",ref_key:"rowDiv",ref:u},[a("div",{id:"button",class:ve(l.value),ref_key:"button",ref:s,onClick:p},[Object.keys(e.children).length!==0?(g(),b("div",{key:0,class:ve(i.value)},null,2)):F("",!0)],2),a("div",da,[D(pe,{checked:y.value,identifier:e.identifier,onOnCheck:c},{default:R(()=>[me(h.$slots,"default",{},void 0,!0)]),_:3},8,["checked","identifier"])])],512),Z(a("div",ca,[(g(!0),b(H,null,Y(h.children,(v,_)=>(g(),G(lt,{identifier:String(_),children:v,"tag-status":o.value,"onUpdate:tagStatus":f[0]||(f[0]=k=>o.value=k)},{default:R(()=>[L(I(String(_).split(x(oe)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tag-status"]))),256))],512),[[$t,!d.value]])],64))}}),lt=E(pa,[["__scopeId","data-v-505f8e28"]]),ha={id:"tagSelector-main",class:"scrollable"},ma=A({__name:"TagSelector",props:{tagStatus:{}},emits:["update:tagStatus"],setup(r,{emit:t}){const e=r,n=t,o=T(()=>_e.tagHierarchy(e.tagStatus.all)),l=T(()=>Object.keys(o.value).sort()),s=T({get:()=>e.tagStatus,set:d=>n("update:tagStatus",d)});return(d,i)=>(g(),b("div",ha,[(g(!0),b(H,null,Y(l.value,p=>(g(),G(lt,{identifier:String(p),children:o.value[p],tagStatus:s.value,"onUpdate:tagStatus":i[0]||(i[0]=y=>s.value=y)},{default:R(()=>[L(I(String(p).split(x(oe)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tagStatus"]))),256))]))}}),it=E(ma,[["__scopeId","data-v-46f6be6a"]]),fa={key:0,class:"prefix"},va=A({__name:"TagBubble",props:{tag:{},tStyle:{default:""}},emits:["click"],setup(r,{emit:t}){const e=r,n=t,o=T(()=>{const l=e.tag.split(oe);return l.length==1?["",l[0]]:[l.slice(0,l.length-1).join("·"),l[l.length-1]]});return(l,s)=>(g(),b("div",{class:ve(`bubble${l.tStyle?" "+l.tStyle:""}`),onClick:s[0]||(s[0]=()=>n("click"))},[o.value[0]?(g(),b("div",fa,I(o.value[0]),1)):F("",!0),L(" "+I(o.value[1]),1)],2))}}),ga=E(va,[["__scopeId","data-v-f454bc70"]]),ya=A({__name:"TagBubbleContainer",props:{tags:{},highlightTags:{default:null},mutedTags:{default:null},maxWidth:{default:null},middleAlign:{type:Boolean,default:!1}},emits:["clickOnBubble"],setup(r,{emit:t}){const e=r,n=t,o=T(()=>{const l={};for(const s of e.tags)e.highlightTags&&e.highlightTags.has(s)?l[s]="highlight":e.mutedTags&&e.mutedTags.has(s)?l[s]="muted":l[s]="";return l});return(l,s)=>(g(),b("div",{id:"bubbleContainer",class:"scrollable",style:J({maxWidth:`${(e.maxWidth?e.maxWidth:999)-10}px`,justifyContent:e.middleAlign?"center":"flex-start"})},[(g(!0),b(H,null,Y(e.tags,d=>(g(),G(ga,{onClick:()=>n("clickOnBubble",d),tag:d,"t-style":o.value[d]},null,8,["onClick","tag","t-style"]))),256))],4))}}),ut=E(ya,[["__scopeId","data-v-4c853b20"]]),Ne=r=>(X("data-v-2e8355c3"),r=r(),ee(),r),_a=Ne(()=>a("h3",{class:"green"},"Tags",-1)),wa=Ne(()=>a("hr",null,null,-1)),ba=Ne(()=>a("hr",null,null,-1)),ka=A({__name:"FileTags",emits:["onCheck"],setup(r,{emit:t}){const e=t,n=M(),o=W(),l=w(null),s=T(()=>M().unfoldedDataUIDs.length==0?null:n.shownDataUIDs.includes(n.unfoldedDataUIDs[0])?W().database.get(M().unfoldedDataUIDs[0]):null),d=T(()=>s.value==null?null:n.tagStatus.checked.withChildsFrom(s.value.tags)),i=T(()=>{const u=n.tagStatus.checked.copy();return s.value!==null&&u.pop_ifcontains_(s.value.tags),u});function p(){n.tagStatus.checked=new O,n.updateShownData()}ae(n.tagStatus,()=>e("onCheck",n.tagStatus),{deep:!0});function y(){const u=prompt("Old tag");if(u&&o.database.getAllTags().has(u)){const m=prompt("New tag");m&&new q().renameTag(u,m).then(()=>{n.showPopup("Tag renamed","success")},()=>{n.showPopup("Failed to rename tag","error")})}else n.showPopup("Invalid tag","warning")}function c(){const u=prompt("Tag to delete");if(u&&o.database.getAllTags().has(u)){if(!confirm(`Are you sure to delete tag "${u}"?`))return;new q().deleteTag(u).then(()=>{n.showPopup("Tag deleted","success")},()=>{n.showPopup("Failed to delete tag","error")})}else n.showPopup("Invalid tag","warning")}return(u,m)=>(g(),b("div",{id:"file-tags-main",ref_key:"ftPanel",ref:l},[a("div",{class:"title"},[a("div",{id:"title-title"},[_a,a("div",{id:"title-buttons"},[a("div",{class:"button",onClick:y},"rename"),a("div",{class:"button",onClick:c},"delete")])]),wa]),D(it,{onOnCheck:m[0]||(m[0]=h=>e("onCheck",h)),tagStatus:x(n).tagStatus,"onUpdate:tagStatus":m[1]||(m[1]=h=>x(n).tagStatus=h)},null,8,["tagStatus"]),ba,D(ut,{onClickOnBubble:m[2]||(m[2]=h=>{x(n).tagStatus.checked.has(h)?x(n).tagStatus.checked.delete(h):x(n).tagStatus.checked.add(h),x(n).updateShownData()}),tags:s.value?s.value.tags:x(n).tagStatus.checked,"highlight-tags":d.value,"muted-tags":i.value,"max-width":l.value?l.value.clientWidth:null},null,8,["tags","highlight-tags","muted-tags","max-width"]),a("div",{class:"buttons"},[a("button",{id:"btnClear",class:"green",onClick:p},"CLEAR SELECTION")])],512))}}),Sa=E(ka,[["__scopeId","data-v-2e8355c3"]]),$a="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-80q-50%200-85-35t-35-85v-120h120v-560h600v680q0%2050-35%2085t-85%2035H240Zm480-80q17%200%2028.5-11.5T760-200v-600H320v480h360v120q0%2017%2011.5%2028.5T720-160ZM360-600v-80h360v80H360Zm0%20120v-80h360v80H360ZM240-160h360v-80H200v40q0%2017%2011.5%2028.5T240-160Zm0%200h-40%20400-360Z'/%3e%3c/svg%3e",He="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M480%20856q-115%200-197.5-82.5T200%20576q0-115%2082.5-197.5T480%20296q115%200%20197.5%2082.5T760%20576q0%20115-82.5%20197.5T480%20856Z'/%3e%3c/svg%3e",Ca="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M331%20625h37v-83h48q15.725%200%2026.362-10.638Q453%20520.725%20453%20505v-48q0-15.725-10.638-26.362Q431.725%20420%20416%20420h-85v205Zm37-120v-48h48v48h-48Zm129%20120h84q15%200%2026-10.638%2011-10.637%2011-26.362V457q0-15.725-11-26.362Q596%20420%20581%20420h-84v205Zm37-37V457h47v131h-47Zm133%2037h37v-83h50v-37h-50v-48h50v-37h-87v205ZM260%20856q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h560q24%200%2042%2018t18%2042v560q0%2024-18%2042t-42%2018H260ZM140%20976q-24%200-42-18t-18-42V296h60v620h620v60H140Z'/%3e%3c/svg%3e",Da="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M251%20896q-88%200-149.5-61.5T40%20685q0-78%2050-137t127-71q20-97%2094-158.5T482%20257q112%200%20189%2081.5T748%20534v24q72-2%20122%2046.5T920%20727q0%2069-50%20119t-119%2050H251Z'/%3e%3c/svg%3e",xa="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554h189L551%20236v186Z'/%3e%3c/svg%3e",Ta="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554V236H220v680h520V422H551ZM220%20236v186-186%20680-680Z'/%3e%3c/svg%3e",Ia=r=>(X("data-v-97dd0391"),r=r(),ee(),r),Pa={key:0,id:"window"},Ua={class:"header"},La=Ia(()=>a("span",{class:"close-icon"},"✕",-1)),Ba=[La],Aa=A({__name:"FloatingWindow",props:{title:{default:"_"},show:{type:Boolean},closeKey:{default:"Escape"},compact:{type:Boolean,default:!1},zIndex:{default:100}},emits:["close","onClose","update:show"],setup(r,{emit:t}){const e=r,n=t,o=T({get:()=>e.show,set:s=>{n("update:show",s)}});function l(){o.value=!1,n("onClose"),n("close")}return window.addEventListener("keydown",s=>{s.key===e.closeKey&&(l(),s.preventDefault())}),(s,d)=>o.value?(g(),b("div",Pa,[a("div",{id:"blocker",onClick:l,style:J({"z-index":s.zIndex-1})},null,4),a("div",{class:"floating-window",style:J({"z-index":s.zIndex})},[a("div",Ua,[a("label",null,I(e.title),1),a("button",{class:"close-button",onClick:l},Ba)]),a("div",{class:"window-content scrollable",style:J({margin:e.compact?"0px":"15px",marginTop:e.compact?"0px":"5px"})},[me(s.$slots,"default",{},void 0,!0)],4)],4)])):F("",!0)}}),Ce=E(Aa,[["__scopeId","data-v-97dd0391"]]),qa={id:"query-dialog-main"},Ra={class:"content"},Ma={id:"buttons"},Ea=A({__name:"QueryDialog",props:{show:{type:Boolean},title:{default:"Query"},showCancel:{type:Boolean,default:!0},zIndex:{default:99}},emits:["update:show","onClose","onAccept","onCancel"],setup(r,{emit:t}){const e=r,n=t,o=T({get:()=>e.show,set:l=>{n("update:show",l)}});return(l,s)=>(g(),G(Ce,{show:o.value,"onUpdate:show":s[2]||(s[2]=d=>o.value=d),title:l.title,compact:!0,"z-index":l.zIndex,onOnClose:s[3]||(s[3]=()=>n("onClose"))},{default:R(()=>[a("div",qa,[a("div",Ra,[me(l.$slots,"default",{},void 0,!0)]),a("div",Ma,[a("div",{class:"button ok-button",onClick:s[0]||(s[0]=()=>n("onAccept"))},"OK"),l.showCancel?(g(),b("div",{key:0,class:"button cancel-button last-button",onClick:s[1]||(s[1]=()=>n("onCancel"))},"Cancel")):F("",!0)])])]),_:3},8,["show","title","z-index"]))}}),he=E(Ea,[["__scopeId","data-v-81948a9f"]]),Oa=r=>(X("data-v-8779a0ab"),r=r(),ee(),r),za={id:"tag-selector-with-entry-main"},Fa={style:{textAlign:"left"}},Na=Oa(()=>a("label",{for:"tagSelector"},"Tags",-1)),Ha={id:"tagSelector",class:"scrollable"},Wa={class:"entry"},Za=A({__name:"TagSelectorWithEntry",props:{tagStatus:{},tagInputValue:{default:""}},emits:["update:tagStatus","update:tagInputValue"],setup(r,{emit:t}){const e=r,n=t,o=T({get:()=>e.tagStatus,set:i=>n("update:tagStatus",i)}),l=w(e.tagInputValue);ae(()=>e.tagInputValue,i=>{l.value=i});const s=T({get:()=>l.value,set:i=>{n("update:tagInputValue",i),l.value=i}}),d=()=>{const i=s.value.trim();i!==""&&(o.value.all.add(i),o.value.checked.add(i),o.value.unfolded.union_(_e.allParentsOf(i)),s.value="")};return(i,p)=>(g(),b("div",za,[a("div",Fa,[Na,a("div",Ha,[D(it,{tagStatus:o.value,"onUpdate:tagStatus":p[0]||(p[0]=y=>o.value=y)},null,8,["tagStatus"])])]),a("div",Wa,[Z(a("input",{type:"text",placeholder:"New tag","onUpdate:modelValue":p[1]||(p[1]=y=>s.value=y),onKeyup:Ee(d,["enter"])},null,544),[[Q,s.value]]),a("button",{class:ve(`green${s.value?" to-be-confirmed":""}`),onClick:d},"ADD",2)])]))}}),dt=E(Za,[["__scopeId","data-v-8779a0ab"]]);async function Va(r=10,t="cat:cs.AI OR cat:cs.CV",e="submittedDate",n="descending"){const l=`https://export.arxiv.org/api/query?${`search_query=${encodeURIComponent(t)}&sortBy=${e}&sortOrder=${n}&max_results=${r}`}`,d=await(await fetch(l,{method:"GET"})).text();let y=new ot.XMLParser().parse(d).feed.entry;Array.isArray(y)||(y=[y]);function c(u){return Array.isArray(u.author)?u.author.map(m=>m.name):u.author?[u.author.name]:[]}if(y&&Array.isArray(y))return y.map(m=>{const h=m.id.split("/").pop().split("v")[0],f=m.id,v=m.title,_=m.summary,k=c(m),S=m.updated,C=m.published;return{id:h,link:f,title:v,abstract:_,authors:k,updatedTime:S,publishedTime:C}});throw new Error("Invalid feed data")}async function ja(r){const t=`https://export.arxiv.org/api/query?id_list=${r}`,n=await(await fetch(t,{method:"GET"})).text();let s=new ot.XMLParser().parse(n).feed.entry;function d(i){return Array.isArray(i.author)?i.author.map(p=>p.name):i.author?[i.author.name]:[]}if(s){const i=s.id.split("/").pop().split("v")[0],p=s.id,y=s.title,c=s.summary,u=d(s),m=s.updated,h=s.published;return{id:i,link:p,title:y,abstract:c,authors:u,updatedTime:m,publishedTime:h}}else throw new Error("Failed to fetch paper from arxiv")}function ct(r){return`@article{${r.id},
  author = {${r.authors.join(" and ")}},
  title = {${r.title}},
  journal = {arXiv preprint arXiv:${r.id}},
  year = {${r.publishedTime.split("-")[0]}},
  abstract = {${r.abstract}}
  }`.replace(/  /g,"")}const Ka=r=>{const t=Math.random().toString(36).substring(7);return r=="article"?`@article{${t},
        author = {},
        title = {},
        journal = {},
        year = {${new Date().getFullYear()}},
        abstract = {},
        volume = {},
        number = {},
        pages = {},
        month = {},
        doi = {},
        }`.replace(/  /g,""):r=="inproceedings"?`@inproceedings{${t},
        author = {},
        title = {},
        booktitle = {},
        year = {${new Date().getFullYear()}},
        abstract = {},
        editor = {},
        volume = {},
        number = {},
        series = {},
        pages = {},
        }`.replace(/  /g,""):r=="webpage"?`@misc{${t},
        title = "{}",
        author = "{}",
        year = {${new Date().getFullYear()}},
        url = "{}",
        note = "{}"
        }`.replace(/  /g,""):""};class Ga{async fromArxiv(t){let e=t.toLowerCase();e.startsWith("arxiv:")?e=e.split("arxiv:")[1]:e.includes("arxiv.org/abs/")?e=e.split("arxiv.org/abs/")[1]:e.includes("arxiv.org/pdf/")&&(e=e.split("arxiv.org/pdf/")[1].split(".pdf")[0]);const n=await ja(e);return{bibtex:ct(n),url:n.link}}async fromWebpage(t){var i;const n=await(await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(t)}`)).text(),s=(i=new DOMParser().parseFromString(n,"text/html").querySelector("title"))==null?void 0:i.innerText;return{bibtex:`@misc{${t},
            author = {},
            title = {${s}},
            url = {${t}},
            year = {${new Date().getFullYear()}},
            }`.replace(/  /g,""),url:t}}async fromDoi(t){const e=`https://api.crossref.org/works/${t}/transform/application/x-bibtex`;return{bibtex:await(await fetch(e,{method:"GET"})).text(),url:`https://doi.org/${t}`}}}const ge=r=>(X("data-v-e9829c2a"),r=r(),ee(),r),Qa={style:{display:"flex",flexDirection:"column",gap:"10px",padding:"10px",width:"100%",height:"100%"}},Ja={style:{margin:"10px"}},Ya=ge(()=>a("legend",null,"Source",-1)),Xa={class:"bibsource-container"},en=ge(()=>a("legend",{for:"bibsource-arxiv"},"arxiv",-1)),tn={class:"bibsource-container"},an=ge(()=>a("legend",{for:"bibsource-doi"},"doi",-1)),nn={class:"bibsource-container"},on=ge(()=>a("legend",{for:"bibsource-webpage"},"webpage",-1)),sn=["placeholder"],rn={key:0},ln={id:"inputDiv"},un={id:"inputLeft"},dn={id:"bibtexArea"},cn={class:"horizontal"},pn=ge(()=>a("label",{for:"bibtex"},"Bibtex",-1)),hn={id:"bibtexSource",class:"horizontal"},mn={id:"urlArea"},fn=ge(()=>a("label",{for:"url"},"URL: ",-1)),vn={id:"inputRight"},gn={key:1},yn=ge(()=>a("div",{style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",height:"430px",width:"590px",border:"5px dashed var(--color-border)","border-radius":"10px",margin:"15px"}},[a("div",{style:{"font-size":"20px","font-weight":"bold","margin-bottom":"10px"}},"Drop to insert citation"),a("div",{style:{"font-size":"12px",opacity:"0.5"}},"(only support bibtex/enw/nbib)")],-1)),_n=[yn],wn=A({__name:"DataEditor",props:{datapoint:{},show:{type:Boolean}},emits:["update:show"],setup(r,{emit:t}){const e=r,n=t,o=T({get:()=>e.show,set:N=>n("update:show",N)}),l=M(),s=w(""),d=w(""),i=w({all:new O,checked:new O,unfolded:new O});function p(){let N=null;e.datapoint&&(N=e.datapoint.summary.uuid),o.value=!1,l.showPopup("Saving entry...","info"),new q().editData(N,s.value,Array.from(i.value.checked),d.value).then(P=>{l.showPopup("Saved","success")},()=>l.showPopup("Failed to save","error"))}const y=w("");ae(o,N=>{N&&(e.datapoint?s.value=e.datapoint.summary.bibtex:s.value="",e.datapoint?d.value=e.datapoint.summary.url:d.value="",i.value={all:new O(l.tagStatus.all),checked:e.datapoint?new O(e.datapoint.summary.tags):new O(l.tagStatus.checked),unfolded:e.datapoint?new O(e.datapoint.summary.tags).allParents():new O(l.tagStatus.unfolded)},y.value="")});const c=w(!1),u=w("article"),m=T(()=>Ka(u.value)),h=w(!1),f=w("arxiv"),v=new Ga,_={arxiv:N=>v.fromArxiv(N),doi:N=>v.fromDoi(N),webpage:N=>v.fromWebpage(N)},k={arxiv:"e.g. 2106.00001",doi:"e.g. 10.1145/344779.344937",webpage:"e.g. https://news.mit.edu/2021/xxx"},S=w("");function C(N){l.showPopup("Fetching from BibTeX source...","info"),h.value=!1,S.value="",_[f.value](N).then(P=>{l.showPopup("Obtained bibtex from source","success"),s.value=P.bibtex,d.value=P.url},()=>{l.showPopup("Failed to fetch from source","error")})}const $=w(!1),U=w(null),B=N=>{N.preventDefault(),$.value=!0},j=N=>{N.preventDefault(),$.value=!1},de=N=>{var z;N.preventDefault();const P=(z=N.dataTransfer)==null?void 0:z.files;if(P&&P.length>0){const ce=P[0];if(ce.size<64*1024){const Ze=new FileReader;Ze.onload=yt=>{var Ve;const _t=(Ve=yt.target)==null?void 0:Ve.result;s.value=_t},Ze.readAsText(ce)}else l.showPopup("File too large","error")}};return ae(o,N=>{N?(window.addEventListener("dragover",B),window.addEventListener("drop",de),window.addEventListener("dragleave",j)):($.value=!1,window.removeEventListener("dragover",B),window.removeEventListener("drop",de),window.removeEventListener("dragleave",j))}),(N,P)=>(g(),b(H,null,[D(he,{show:c.value,"onUpdate:show":P[3]||(P[3]=z=>c.value=z),onOnAccept:P[4]||(P[4]=()=>{s.value=m.value,c.value=!1}),onOnCancel:P[5]||(P[5]=z=>c.value=!1),"z-index":102,title:"Select template"},{default:R(()=>[a("div",Qa,[D(pe,{onOnCheck:P[0]||(P[0]=z=>u.value="article"),checked:u.value=="article"},{default:R(()=>[L("Article")]),_:1},8,["checked"]),D(pe,{onOnCheck:P[1]||(P[1]=z=>u.value="inproceedings"),checked:u.value=="inproceedings"},{default:R(()=>[L("Inproceedings")]),_:1},8,["checked"]),D(pe,{onOnCheck:P[2]||(P[2]=z=>u.value="webpage"),checked:u.value=="webpage"},{default:R(()=>[L("Webpage")]),_:1},8,["checked"])])]),_:1},8,["show"]),D(he,{show:h.value,"onUpdate:show":P[10]||(P[10]=z=>h.value=z),onOnCancel:P[11]||(P[11]=z=>h.value=!1),onOnAccept:P[12]||(P[12]=()=>{C(S.value)}),"z-index":102,title:"Source input"},{default:R(()=>[a("div",Ja,[a("fieldset",{style:J({display:"flex",flexDirection:"row",gap:"10px",border:"1px solid var(--color-border)"})},[Ya,a("div",Xa,[Z(a("input",{type:"radio",id:"bibsource-arxiv",name:"bibSource",value:"arxiv","onUpdate:modelValue":P[6]||(P[6]=z=>f.value=z)},null,512),[[Ae,f.value]]),en]),a("div",tn,[Z(a("input",{type:"radio",id:"bibsource-doi",name:"bibSource",value:"doi","onUpdate:modelValue":P[7]||(P[7]=z=>f.value=z)},null,512),[[Ae,f.value]]),an]),a("div",nn,[Z(a("input",{type:"radio",id:"bibsource-webpage",name:"bibSource",value:"webpage","onUpdate:modelValue":P[8]||(P[8]=z=>f.value=z)},null,512),[[Ae,f.value]]),on])],4),Z(a("input",{type:"text","onUpdate:modelValue":P[9]||(P[9]=z=>S.value=z),placeholder:k[f.value],style:{width:"100%",marginTop:"10px"}},null,8,sn),[[Q,S.value]])])]),_:1},8,["show"]),D(he,{show:o.value,"onUpdate:show":P[19]||(P[19]=z=>o.value=z),title:N.datapoint?N.datapoint.authorAbbr():"new","show-cancel":!1,onOnAccept:p,onOnCancel:P[20]||(P[20]=()=>o.value=!1)},{default:R(()=>[a("div",{id:"data-editor-main",ref_key:"dataEditorComponent",ref:U},[$.value?(g(),b("div",gn,_n)):(g(),b("div",rn,[a("div",ln,[a("div",un,[a("div",dn,[a("div",cn,[pn,a("div",hn,[a("div",{class:"button",onClick:P[13]||(P[13]=z=>c.value=!0)},"template"),a("div",{class:"button",onClick:P[14]||(P[14]=z=>h.value=!0)},"from-source")])]),Z(a("textarea",{id:"bibtex","onUpdate:modelValue":P[15]||(P[15]=z=>s.value=z),placeholder:"bibtex / enw / nbib"},null,512),[[Q,s.value]])]),a("div",mn,[fn,Z(a("input",{id:"url","onUpdate:modelValue":P[16]||(P[16]=z=>d.value=z),placeholder:"url",type:"text"},null,512),[[Q,d.value]])])]),a("div",vn,[D(dt,{"tag-status":i.value,"onUpdate:tagStatus":P[17]||(P[17]=z=>i.value=z),"tag-input-value":y.value,"onUpdate:tagInputValue":P[18]||(P[18]=z=>y.value=z)},null,8,["tag-status","tag-input-value"])])])]))],512)]),_:1},8,["show","title"])],64))}}),pt=E(wn,[["__scopeId","data-v-e9829c2a"]]),bn={key:0,id:"arrow"},kn=["onKeydown","onClick"],Sn=A({__name:"Menu",props:{show:{type:Boolean},menuItems:{},position:{},blocker:{type:Boolean,default:!1},middleTop:{type:Boolean,default:!1},zIndex:{default:100},arrow:{type:Boolean,default:!1}},emits:["update:show"],setup(r,{emit:t}){const e=r,n=t,o=T({get:()=>e.show,set:s=>{n("update:show",s)}});function l(){o.value=!1}return(s,d)=>(g(),b(H,null,[s.blocker?(g(),b("div",{key:0,id:"blocker",onClick:l,style:J({zIndex:e.zIndex-1})},null,4)):F("",!0),a("div",{id:"floatingMenu",style:J({left:e.position.x+"px",top:e.position.y+"px",visibility:o.value?"visible":"hidden",transform:e.middleTop?"translate(-50%, 0)":"",zIndex:e.zIndex})},[e.arrow?(g(),b("div",bn)):F("",!0),(g(!0),b(H,null,Y(e.menuItems,(i,p)=>(g(),b("div",{class:ve(`non-selectable floatingMenuItem${p!==e.menuItems.length-1?"":" floatingMenuItemLast"}`),tabindex:"0",onKeydown:Ee(y=>{i.action(),l()},["enter"]),onClick:y=>{i.action(),l()}},I(i.name),43,kn))),256))],4)],64))}}),$n=E(Sn,[["__scopeId","data-v-c6b659c7"]]),Be=A({name:"file-select-button",props:{asLink:{type:Boolean,default:!1},text:{type:String,default:"Upload"},action:{type:Function,required:!0},style:{type:Object,default:()=>({})}},setup(r,t){const e=w(null),n=l=>{const s=l.target;if(s.files&&s.files.length>0){const d=s.files[0];r.action(d)}};function o(){e.value.click()}return t.expose({click:o}),()=>D(H,null,[D("input",{type:"file",id:"upload-file",onChange:n,ref:e,style:{display:"none"}},null),r.asLink?D("a",{class:"btn upload-btn",rel:"noopener noreferrer",onClick:()=>e.value.click(),style:r.style},[r.text]):D("button",{type:"button",class:"btn upload-btn",onClick:()=>e.value.click(),style:r.style},[r.text])])}}),We=A({name:"editable-paragraph",props:{contentEditable:{type:Boolean,default:!0},style:{type:Object,default:()=>({})}},emits:["finish","change"],setup(r,t){const e=w(null),n=c=>{e.value.innerText=c},o=c=>{e.value.contentEditable=c.toString()},l=c=>e.value.contains(c),s=function(){return document.activeElement===e.value},d=T({get(){return e.value.innerText},set(c){e.value.innerText=c}});t.expose({setText:n,setEditable:o,contains:l,innerText:d,hasFocus:s});const i=()=>{t.emit("change",e.value.innerText)},p=()=>{t.emit("finish",e.value.innerText)},y=c=>{if(c.key==="Enter")if(c.ctrlKey||c.metaKey){c.preventDefault();const u=window.getSelection(),m=u==null?void 0:u.getRangeAt(0);if(m){const h=document.createElement("br");m.insertNode(h),m.setStartAfter(h),m.setEndAfter(h),u==null||u.removeAllRanges(),u==null||u.addRange(m)}}else e.value.blur()};return()=>D("p",{class:"editable-paragraph",contenteditable:r.contentEditable,ref:e,onInput:i,onBlur:p,onKeydown:y,style:r.style},[t.slots.default&&t.slots.default()])}}),ht=A({name:"menu-attached",props:{menuItems:{type:Array,required:!0}},setup(r,t){const e=w(!1),n=w(null),o=w({x:0,y:0});return ae(e,l=>{if(l){const s=n.value.getBoundingClientRect();o.value={x:s.left+s.width/2,y:s.bottom+5}}else o.value={x:0,y:0}}),()=>D("div",null,[D("div",{ref:n,onClick:()=>e.value=!e.value,onKeydown:l=>{l.key==="Enter"&&(l.preventDefault(),e.value=!e.value)}},[t.slots.default&&t.slots.default()]),D($n,{show:e.value,"onUpdate:show":l=>e.value=l,menuItems:r.menuItems,position:o.value,middleTop:!0,arrow:!0},null)])}}),Cn=A({name:"CircularImage",props:{href:{type:String,required:!0},size:{type:String,required:!0},alt:{type:String,default:""}},emits:["click"],setup(r,t){const e={width:`${r.size}`,height:`${r.size}`,borderRadius:"50%",border:"1px solid var(--color-border)",overflow:"hidden"};return()=>D("img",{src:r.href,alt:r.alt,style:e,onClick:()=>t.emit("click")},null)}}),ye=r=>(X("data-v-d776aaaa"),r=r(),ee(),r),Dn={class:"layout"},xn={id:"info"},Tn=ye(()=>a("td",null,[a("b",null,"Authors")],-1)),In={id:"authorTD"},Pn=["onClick"],Un={key:0,id:"otherPubTR"},Ln={colspan:"2"},Bn={id:"authorPapers"},An=ye(()=>a("td",null,[a("b",null,"Publication")],-1)),qn=ye(()=>a("td",null,[a("b",null,"Year")],-1)),Rn=ye(()=>a("td",null,[a("b",null,"Tags")],-1)),Mn=ye(()=>a("td",null,[a("b",null,"Type")],-1)),En={id:"shortSummary"},On={id:"shortSummaryTitle"},zn=ye(()=>a("b",null,"AI Summary",-1)),Fn=ye(()=>a("summary",null,[a("b",null,"Related Articles")],-1)),Nn=A({__name:"DataSummary",props:{datapoint:{}},setup(r){const t=r,e=W(),n=w([]),o=w([]),l=T(()=>Object.fromEntries(n.value.map((v,_)=>[v.summary.uuid,o.value[_].toPrecision(3)]))),s=new q,d=w(null),i=w("");function p(v=!1){i.value="Loading...";let _="";s.reqAISummary(t.datapoint.summary.uuid,k=>{k.replace(/\\n/g,"<br>"),_+=k,i.value=_},()=>{y(),console.log("finished")},v)}async function y(){let v=null;if(t.datapoint.supp.abstract?v=t.datapoint.supp.abstract:v=await t.datapoint.fetchAbstract(),!v)if(i.value&&!i.value.startsWith("Error")&&!i.value.startsWith("Loading"))v=i.value;else throw new Error("No content to search for related articles");if(v=="")return;const k=await new q().search("searchFeature",{pattern:v,n_return:9}),S=new Array,C=new Array;for(const $ of e.database.getDataByTags([]))if(k[$.summary.uuid]){S.push($);const U=k[$.summary.uuid].score;C.push(U)}[n.value,o.value]=ze.sortByScore(S,C,!1),n.value&&n.value[0].summary.uuid==t.datapoint.summary.uuid&&(n.value.shift(),o.value.shift())}const c=w(""),u=w([]);function m(v){v=be(v),console.log("check publication of author: ",v),u.value=e.authorPublicationMap[v],u.value=u.value.filter(_=>_.summary.uuid!=t.datapoint.summary.uuid),c.value===v?c.value="":c.value=v}function h(v){const _=e.authorPublicationMap;return v=be(v),!(v in _)||_[v].length==1?null:_[v].length-1}ke(()=>{p(!1)});const f=T(()=>{const C=(Math.min(Math.max(window.innerWidth-600,0)/1800,1)-.5)*Math.PI,$=(Math.sin(C)+1)*.5*1200,U=Math.round($);return`${window.innerWidth-U}px`});return(v,_)=>(g(),b("div",{id:"main",style:J({width:f.value})},[a("h2",null,I(v.datapoint.summary.title),1),a("div",Dn,[a("div",xn,[a("table",null,[a("tr",null,[Tn,a("td",In,[(g(!0),b(H,null,Y(v.datapoint.summary.authors,k=>(g(),b("div",null,[a("span",null,I(k),1),h(k)!==null?(g(),b("a",{key:0,onClick:()=>m(k)}," ("+I(h(k))+") ",9,Pn)):F("",!0)]))),256))])]),D($e,{name:"slideDown"},{default:R(()=>[c.value?(g(),b("tr",Un,[a("td",Ln,[a("b",null,I(`Other publications from ${c.value.toUpperCase()}:`),1),a("div",Bn,[D(De,{datapoints:u.value},null,8,["datapoints"])])])])):F("",!0)]),_:1}),a("tr",null,[An,a("td",null,I(v.datapoint.summary.publication),1)]),a("tr",null,[qn,a("td",null,I(v.datapoint.summary.year),1)]),a("tr",null,[Rn,a("td",null,I(v.datapoint.summary.tags.toString()),1)]),a("tr",null,[Mn,a("td",null,I(v.datapoint.docType()+`${v.datapoint.summary.has_file?" ("+v.datapoint.summary.doc_size.toString()+"M)":""}`),1)])])]),a("div",En,[a("div",On,[zn,a("div",{class:"button",onClick:_[0]||(_[0]=k=>p(!0))},"↻")]),a("p",{id:"aiSummary",ref_key:"aiSummaryParagraph",ref:d},I(i.value),513)]),a("details",null,[Fn,D(De,{datapoints:n.value,scores:l.value},null,8,["datapoints","scores"])])])],4))}}),Hn=E(Nn,[["__scopeId","data-v-d776aaaa"]]),Wn=r=>(X("data-v-05bf278b"),r=r(),ee(),r),Zn={id:"citations",style:{textAlign:"left"}},Vn=["onClick"],jn={class:"citation-text",style:{overflowX:"hidden",whiteSpace:"nowrap"}},Kn={key:0},Gn={key:0,id:"moreMain"},Qn={class:"row",id:"buttons"},Jn={key:0,class:"row",id:"actions"},Yn={id:"abstract"},Xn=Wn(()=>a("summary",null,"Abstract",-1)),eo=A({__name:"FileRowMore",props:{datapoint:{},show:{type:Boolean}},setup(r,{expose:t}){const e=r,n=M(),o=w(null),l=async k=>{k.target instanceof HTMLDetailsElement&&!k.target.open||(o.value.setEditable(!1),o.value.innerText="Loading...",e.datapoint.fetchAbstract().then(S=>{o.value.innerText=S,o.value.setEditable(!0)},()=>{o.value.innerText="Failed to load abstract."}))},s=async k=>{k&&(await e.datapoint.uploadAbstract(k),await e.datapoint.update())},d=w(!1);function i(k,S){return[k,`${S.length>80?S.slice(0,80)+"...":S}`,S]}function p(k){Nt(k).then(S=>{S?n.showPopup("Copied to clipboard.","info"):n.showPopup("Failed to copy to clipboard.","error")})}const y=w(!1);function c(k){n.showPopup("uploading..."),e.datapoint.uploadDocument(k).then(S=>{e.datapoint.update(S),n.showPopup("Document uploaded","success")},()=>n.showPopup("Failed to upload document","error"))}function u(){window.confirm(`Free document? 
${e.datapoint.toString()}`)&&e.datapoint.freeDocument().then(k=>{e.datapoint.update(k),n.showPopup("Document deleted","info")},()=>n.showPopup("Failed to free document","error"))}function m(){const k=e.datapoint.summary.uuid;window.confirm(`[IMPORTANT] Delete? 
${e.datapoint.toString()}`)&&new q().deleteData(k).then(S=>{n.showPopup("Deleted")})}const h=w(!1);function f(){h.value=!0}const v=T(()=>o.value===null?!h.value:!h.value&&!o.value.hasFocus());t({editThisDatapoint:f,shouldEnableEditDatapoint:v});const _=w(!1);return(k,S)=>{const C=tt("router-link");return g(),b(H,null,[D(Ce,{show:_.value,"onUpdate:show":S[0]||(S[0]=$=>_.value=$),title:"Summary"},{default:R(()=>[D(Hn,{datapoint:k.datapoint},null,8,["datapoint"])]),_:1},8,["show"]),D(Ce,{show:d.value,"onUpdate:show":S[1]||(S[1]=$=>d.value=$),title:"Citations"},{default:R(()=>[(g(!0),b(H,null,Y([i("Title",`${k.datapoint.summary.title}`),i("Author-year",`${k.datapoint.authorAbbr()} (${k.datapoint.summary.year})`),i("APA",`${k.datapoint.authorAbbr()} (${k.datapoint.summary.year}). ${k.datapoint.summary.title}. ${k.datapoint.summary.publication}.`),i("Bibtex",k.datapoint.summary.bibtex),i("DocURL",k.datapoint.getRawDocURL()),i("Markdown",`[${k.datapoint.authorAbbr()} (${k.datapoint.summary.year})](${k.datapoint.getRawDocURL()})`)],($,U)=>(g(),b("div",Zn,[a("div",{onClick:()=>{p($[2]),d.value=!1},style:{cursor:"pointer",display:"flex",flexDirection:"row"}},[a("div",{class:"citation-type",style:J({marginLeft:"10px",marginRight:"10px",borderRadius:"5px",backgroundColor:"var(--color-background-mute)",padding:"3px",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center"})},I($[0]),5),a("p",jn,I($[1]),1)],8,Vn),U!==5?(g(),b("hr",Kn)):F("",!0)]))),256))]),_:1},8,["show"]),D(pt,{show:h.value,"onUpdate:show":S[2]||(S[2]=$=>h.value=$),datapoint:k.datapoint},null,8,["show","datapoint"]),D($e,{name:"expand-transition"},{default:R(()=>[k.show?(g(),b("div",Gn,[a("div",Qn,[D(C,{to:`/reader/${e.datapoint.summary.uuid}`},{default:R(()=>[L("Reader")]),_:1},8,["to"]),a("a",{rel:"noopener noreferrer",onClick:S[3]||(S[3]=()=>_.value=!_.value)},"Summary"),a("a",{rel:"noopener noreferrer",onClick:S[4]||(S[4]=()=>d.value=!d.value)},"Cite"),a("a",{rel:"noopener noreferrer",onClick:S[5]||(S[5]=()=>y.value=!y.value)},"Actions")]),D($e,{name:"actions"},{default:R(()=>[y.value?(g(),b("div",Jn,[a("a",{rel:"noopener noreferrer",class:"btn",onClick:f},"Edit"),k.datapoint.summary.has_file?(g(),b("a",{key:1,rel:"noopener noreferrer",onClick:u,class:"danger btn"},"Free document")):(g(),G(x(Be),{key:0,action:$=>c($),text:"Upload document","as-link":!0},null,8,["action"])),a("a",{rel:"noopener noreferrer",onClick:m,class:"danger btn"},"Delete")])):F("",!0)]),_:1}),a("div",Yn,[a("details",{onToggle:l},[Xn,D(x(We),{id:"abstractParagraph",ref_key:"abstractParagraph",ref:o,style:{minHeight:"20px"},onFinish:S[6]||(S[6]=$=>s($))},null,512)],32)])])):F("",!0)]),_:1})],64)}}}),to=E(eo,[["__scopeId","data-v-05bf278b"]]),Ye=[];class K{static registerThemeChangeCallback(t){Ye.push(t)}static toggleDarkMode(){document.documentElement.classList.contains("light")?K.setDarkMode(!0):document.documentElement.classList.contains("dark")?K.setDarkMode(!1):(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,K.setDarkMode(!0))}static isDefaultDarkMode(){return!!(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)}static isDarkMode(){return document.documentElement.classList.contains("light")?!1:!!document.documentElement.classList.contains("dark")}static setDefaultDarkMode(){const t=localStorage.getItem("themeMode");t==="dark"?K.setDarkMode(!0):t=="light"?K.setDarkMode(!1):K.isDefaultDarkMode()&&!K.isDarkMode()&&K.toggleDarkMode()}static setDarkMode(t){t?(document.documentElement.classList.remove("light"),document.documentElement.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"));const e=t?"dark":"light";if(localStorage.getItem("themeMode")!==e){localStorage.setItem("themeMode",t?"dark":"light");for(let n of Ye)n(t)}}}function Xe(r,t){let e=r.parentNode;for(;e!=null;){if(e==t)return!0;e=e.parentNode}return!1}function Se(r){if(r===null||typeof r!="object")return r;let t=Array.isArray(r)?[]:{};for(let e in r)t[e]=Se(r[e]);return t}const ao="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120v-640q0-33%2023.5-56.5T280-840h400q33%200%2056.5%2023.5T760-760v640L480-240%20200-120Zm80-122%20200-86%20200%2086v-518H280v518Zm0-518h400-400Z'/%3e%3c/svg%3e",no="data:image/svg+xml,%3c?xml%20version='1.0'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20width='24px'%20height='24px'%3e%3cpath%20d='M%206%202%20C%205.861875%202%205.7278809%202.0143848%205.5976562%202.0410156%20C%204.686084%202.2274316%204%203.033125%204%204%20L%204%2022%20L%2012%2019%20L%2020%2022%20L%2020%204%20C%2020%203.8625%2019.985742%203.7275391%2019.958984%203.5976562%20C%2019.799199%202.8163086%2019.183691%202.2008008%2018.402344%202.0410156%20C%2018.272119%202.0143848%2018.138125%202%2018%202%20L%206%202%20z'/%3e%3c/svg%3e",oo={class:"left row"},so={id:"marks"},ro=["src"],lo=["src"],io={id:"title",class:"text"},uo={class:"right row"},co={id:"statusDiv"},po={class:"status"},ho={key:0,src:$a,alt:"",class:"icon"},mo={key:1,src:He,alt:"",class:"icon placeholder"},fo={class:"status"},vo={key:0,src:Ca,alt:"",class:"icon"},go={key:1,src:Da,alt:"",class:"icon"},yo={key:2,src:He,alt:"",class:"icon placeholder"},_o={class:"status"},wo={key:0,src:xa,alt:"",class:"icon"},bo={key:1,src:Ta,alt:"",class:"icon"},ko={key:2,src:He,alt:"",class:"icon placeholder"},So=12,$o=1,Co=A({__name:"FileRow",props:{datapoint:{},unfoldedIds:{},hoveredIds:{},line_number:{default:0},compact:{type:Boolean,default:!1}},emits:["update:unfoldedIds","update:hoveredIds"],setup(r,{emit:t}){const e=r,n=t,o=T({get:()=>e.unfoldedIds,set:U=>n("update:unfoldedIds",U)}),l=T({get:()=>e.hoveredIds,set:U=>n("update:hoveredIds",U)}),s=T(()=>o.value.includes(e.datapoint.summary.uuid)),d=w(!1),i=w(null),p=w(null),y=w(null),c=w(null),u=w(null);let m=!1;function h(U){if(Xe(U.target,i.value)){if(U.target.id=="authorYear"){const B=e.datapoint.getOpenDocURL();B!==""&&Pe(B),m=!0}if(!Xe(U.target,y.value)){if(m){m=!1;return}s.value?o.value=o.value.filter(B=>B!==e.datapoint.summary.uuid):o.value=[e.datapoint.summary.uuid]}}}function f(){d.value=!0}function v(){d.value=!1}const _=T(()=>{if(d.value){const B=e.datapoint.docType();return B===""?"_":B}else return e.datapoint.yearAuthor(" :: ")}),k=w(!1);ae(k,U=>{U?l.value.push(e.datapoint.summary.uuid):l.value=l.value.filter(B=>B!==e.datapoint.summary.uuid)});const S=T(()=>k.value?"var(--color-background-theme-highlight)":o.value.includes(e.datapoint.summary.uuid)?"var(--color-background-theme)":!e.compact||e.line_number%2==0?"var(--color-background-ssoft)":"var(--color-background)");function C(U){const B=e.datapoint.summary.tags.slice();U?B.push("* Bookmark"):B.splice(B.indexOf("* Bookmark"),1);const j=e.datapoint.summary.uuid;new q().editData(j,null,B).then(de=>{e.datapoint.update(de),M().updateShownData()},()=>M().showPopup("Failed to save","error")),m=!0}function $(U){var B,j;U.code==="Space"&&o.value.includes(e.datapoint.summary.uuid)&&k.value&&document.activeElement===document.body&&(B=c.value)!=null&&B.shouldEnableEditDatapoint&&((j=c.value)==null||j.editThisDatapoint(),U.preventDefault())}return ae(()=>o.value,U=>{U.includes(e.datapoint.summary.uuid)?window.addEventListener("keydown",$):window.removeEventListener("keydown",$)}),(U,B)=>(g(),b("div",{id:"fileRow",class:ve(`${e.compact&&!s.value?" compact":""}${s.value?" unfolded":""}`),onClick:h,onMouseover:B[2]||(B[2]=j=>k.value=!0),onMouseleave:B[3]||(B[3]=j=>k.value=!1),ref_key:"dataCard",ref:i,style:J({backgroundColor:S.value})},[a("div",{id:"init",class:"row",ref_key:"initDiv",ref:p},[a("div",oo,[a("div",{id:"leadingStatus",class:"row",ref_key:"leadingStatus",ref:u},[a("div",{id:"authorYear",class:"row text",onMouseover:f,onMouseleave:v},I(_.value),33),a("div",so,[U.datapoint.summary.tags.includes("* Bookmark")?(g(),b("img",{key:0,src:x(no),alt:"",class:"icon redIcon",onClick:B[0]||(B[0]=()=>C(!1))},null,8,ro)):(g(),b("img",{key:1,src:x(ao),alt:"",class:"icon",onClick:B[1]||(B[1]=()=>C(!0))},null,8,lo))])],512),a("div",io,I(U.datapoint.summary.title),1),me(U.$slots,"default",{},void 0,!0)]),a("div",uo,[a("div",co,[a("div",po,[U.datapoint.summary.has_abstract?(g(),b("img",ho)):(g(),b("img",mo))]),a("div",fo,[U.datapoint.summary.file_type==".pdf"?(g(),b("img",vo)):U.datapoint.summary.url?(g(),b("img",go)):(g(),b("img",yo))]),a("div",_o,[U.datapoint.summary.note_linecount>So?(g(),b("img",wo)):U.datapoint.summary.note_linecount>$o?(g(),b("img",bo)):(g(),b("img",ko))])])])],512),a("div",{id:"more",ref_key:"moreDiv",ref:y},[D(to,{datapoint:U.datapoint,show:s.value,ref_key:"moreComponent",ref:c},null,8,["datapoint","show"])],512)],38))}}),Do=E(Co,[["__scopeId","data-v-7c60bf17"]]),xo={id:"datacard-container-main"},To={key:0,class:"relatedArticleScore"},Io={key:0,id:"datacard-container-footer"},Po=["disabled"],Uo={style:{"margin-left":"10px","margin-right":"10px",display:"flex",gap:"5px"}},Lo=["disabled"],Bo=A({__name:"FileRowContainer",props:{datapoints:{},unfoldedIds:{default:null},hoveredIds:{default:null},scores:{default:null},compact:{type:Boolean,default:!0}},emits:["update:datapoints","update:unfoldedIds","update:hoveredIds"],setup(r,{emit:t}){const e=r,n=t,o=w([]),l=T({get:()=>e.unfoldedIds==null?o.value:e.unfoldedIds,set:_=>{e.unfoldedIds==null?o.value=_:n("update:unfoldedIds",_)}}),s=w([]),d=T({get:()=>e.hoveredIds==null?s.value:e.hoveredIds,set:_=>{e.hoveredIds==null?s.value=_:n("update:hoveredIds",_)}}),i=T({get:()=>e.datapoints,set:_=>n("update:datapoints",_)}),p=w(null),y=w(null),c=w(0),u=w(100),m=T(()=>{const _=c.value*u.value,k=Math.min(_+u.value,i.value.length);return i.value.slice(_,k)}),h=()=>{var _;c.value>=Math.ceil(i.value.length/u.value)-1||(c.value++,y.value.setText(""+(c.value+1)),(_=p.value)==null||_.scrollTo({top:0,behavior:"auto"}))},f=()=>{var _;c.value!=0&&(c.value--,y.value.setText(""+(c.value+1)),(_=p.value)==null||_.scrollTo({top:0,behavior:"auto"}))},v=_=>{const k=_.target;k.scrollTop==0||k.scrollTop+k.clientHeight>=k.scrollHeight};return(_,k)=>(g(),b("div",xo,[a("div",{id:"datacard-container",style:J({gap:_.compact?"0px":"5px"}),ref_key:"datacardContainer",ref:p,onScroll:v,class:"scrollable"},[(g(!0),b(H,null,Y(m.value,(S,C)=>(g(),G(Do,{datapoint:S,"unfolded-ids":l.value,"onUpdate:unfoldedIds":k[0]||(k[0]=$=>l.value=$),"hovered-ids":d.value,"onUpdate:hoveredIds":k[1]||(k[1]=$=>d.value=$),line_number:C,compact:_.compact},{default:R(()=>[e.scores!=null&&e.scores[S.summary.uuid]!=null?(g(),b("label",To,I(e.scores[S.summary.uuid]),1)):F("",!0)]),_:2},1032,["datapoint","unfolded-ids","hovered-ids","line_number","compact"]))),256))],36),i.value.length>u.value?(g(),b("div",Io,[a("button",{onClick:f,disabled:c.value==0},"Prev",8,Po),a("span",Uo,[D(x(We),{ref_key:"pageIndicatorEditableParagrah",ref:y,onFinish:k[2]||(k[2]=S=>{/^\d+$/.test(S)&&parseInt(S)>0&&parseInt(S)<=Math.ceil(i.value.length/u.value)&&(c.value=parseInt(S)-1)})},{default:R(()=>[L(I(c.value+1),1)]),_:1},512),L(" / "),a("p",null,I(Math.ceil(i.value.length/u.value)),1)]),a("button",{onClick:h,disabled:c.value>=Math.ceil(i.value.length/u.value)-1},"Next",8,Lo)])):F("",!0)]))}}),De=E(Bo,[["__scopeId","data-v-aa1ed799"]]),Ao=["title"],qo=["src","alt"],Ro={for:"icon",class:"iconLabel non-selectable"},Mo=A({__name:"BannerIcon",props:{iconSrc:{},labelText:{},title:{default:""},shortcut:{default:null}},emits:["onClick","click"],setup(r,{expose:t,emit:e}){const n=r,o=T(()=>n.title+(n.shortcut===null?"":` (${n.shortcut})`)),l=e,s=w(null);t({getBoundingClientRect:()=>{var c;return(c=s.value)==null?void 0:c.getBoundingClientRect()}});function i(){l("onClick"),l("click")}function p(c){if(c===null)return null;const u=c.toLowerCase().split("+");return m=>{u.includes("ctrl")&&!m.ctrlKey||u.includes("alt")&&!m.altKey||u.includes("shift")&&!m.shiftKey||u.includes("meta")&&!m.metaKey||u.includes(m.key.toLowerCase())&&(console.log("shortcut triggered: "+c+" | "+n.labelText),i(),m.preventDefault())}}const y=p(n.shortcut);return Me(()=>{y!==null&&window.addEventListener("keydown",y)}),at(()=>{y!==null&&window.removeEventListener("keydown",y)}),(c,u)=>(g(),b("span",{class:"hoverMaxout105 button non-selecable",onClick:i,onKeydown:Ee(i,["enter"]),tabindex:0,title:`${o.value}`,ref_key:"button",ref:s},[a("img",{id:"icon",class:"icon",src:c.iconSrc,alt:c.labelText.toUpperCase()+"_ICON"},null,8,qo),a("label",Ro,I(c.labelText),1)],40,Ao))}}),re=E(Mo,[["__scopeId","data-v-fc643a9e"]]),Eo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M180%20936q-24%200-42-18t-18-42V276q0-24%2018-42t42-18h291v60H180v600h291v60H180Zm486-185-43-43%20102-102H375v-60h348L621%20444l43-43%20176%20176-174%20174Z'/%3e%3c/svg%3e",Oo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='m263-263%20290-143%20143-290-290%20143-143%20290Zm217-177q-17%200-28.5-11.5T440-480q0-17%2011.5-28.5T480-520q17%200%2028.5%2011.5T520-480q0%2017-11.5%2028.5T480-440Zm0%20360q-82%200-155-31.5t-127.5-86Q143-252%20111.5-325T80-480q0-83%2031.5-156t86-127Q252-817%20325-848.5T480-880q83%200%20156%2031.5T763-763q54%2054%2085.5%20127T880-480q0%2082-31.5%20155T763-197.5q-54%2054.5-127%2086T480-80Zm0-60q142%200%20241-99.5T820-480q0-142-99-241t-241-99q-141%200-240.5%2099T140-480q0%20141%2099.5%20240.5T480-140Zm0-340Z'/%3e%3c/svg%3e",zo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='m887%20489-23-50-50-23%2050-23%2023-50%2023%2050%2050%2023-50%2023-23%2050ZM760%20314l-35-74-74-35%2074-35%2035-74%2035%2074%2074%2035-74%2035-35%2074ZM360%20976q-34%200-57.5-23.5T279%20895h162q0%2034-23.5%2057.5T360%20976ZM198%20833v-60h324v60H198Zm5-121q-66-43-104.5-107.5T60%20459q0-122%2089-211t211-89q122%200%20211%2089t89%20211q0%2081-38%20145.5T517%20712H203Zm22-60h271q48-32%2076-83t28-110q0-99-70.5-169.5T360%20219q-99%200-169.5%2070.5T120%20459q0%2059%2028%20110t77%2083Zm135%200Z'/%3e%3c/svg%3e",Fo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-200h120v-240h240v240h120v-360L480-740%20240-560v360Zm-80%2080v-480l320-240%20320%20240v480H520v-240h-80v240H160Zm320-350Z'/%3e%3c/svg%3e",No={class:"button"},Ho=A({__name:"Banner",props:{returnHome:{type:Boolean,default:!0}},setup(r){const t=r,e=fe();function n(){Zt()}K.setDefaultDarkMode();const o=w(K.isDarkMode()),l=T(function(){return o.value?"LightMode":"DarkMode"});function s(){K.toggleDarkMode(),o.value=!o.value}const d=w(null);let i=0;return window.addEventListener("scroll",function(){const p=window.scrollY||document.documentElement.scrollTop;p<=i||i<10?d.value&&d.value.classList.contains("hidden")&&d.value.classList.remove("hidden"):d.value&&!d.value.classList.contains("hidden")&&d.value.classList.add("hidden"),i=p}),(p,y)=>(g(),b("div",{class:"main-banner shadow",ref_key:"mainDiv",ref:d},[a("div",No,[t.returnHome?(g(),G(re,{key:0,iconSrc:x(Fo),labelText:"Home",shortcut:"ctrl+h",onOnClick:y[0]||(y[0]=()=>{x(e).push("/")}),title:"home"},null,8,["iconSrc"])):(g(),G(re,{key:1,iconSrc:x(Eo),labelText:"Logout",shortcut:"ctrl+q",onOnClick:n,title:"logout"},null,8,["iconSrc"])),D(x(ht),{menuItems:[{name:"Home",action:()=>{x(e).push("/")}},{name:"Dashboard",action:()=>{x(e).push(`/dashboard/${x(W)().user.username}`)}},{name:"Arxiv daily",action:()=>{x(e).push("/feed")}},{name:"About",action:()=>{x(e).push("/about")}}]},{default:R(()=>[D(re,{iconSrc:x(Oo),labelText:"Explore",shortcut:"ctrl+e",title:"look around"},null,8,["iconSrc"])]),_:1},8,["menuItems"]),D(re,{iconSrc:x(zo),labelText:l.value,shortcut:"ctrl+t",onOnClick:y[1]||(y[1]=()=>s()),title:"change theme"},null,8,["iconSrc","labelText"])]),me(p.$slots,"default",{},void 0,!0)],512))}}),xe=E(Ho,[["__scopeId","data-v-18159abb"]]),Wo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M453-280h60v-166h167v-60H513v-174h-60v174H280v60h173v166Zm27.266%20200q-82.734%200-155.5-31.5t-127.266-86q-54.5-54.5-86-127.341Q80-397.681%2080-480.5q0-82.819%2031.5-155.659Q143-709%20197.5-763t127.341-85.5Q397.681-880%20480.5-880q82.819%200%20155.659%2031.5Q709-817%20763-763t85.5%20127Q880-563%20880-480.266q0%2082.734-31.5%20155.5T763-197.684q-54%2054.316-127%2086Q563-80%20480.266-80Zm.234-60Q622-140%20721-239.5t99-241Q820-622%20721.188-721%20622.375-820%20480-820q-141%200-240.5%2098.812Q140-622.375%20140-480q0%20141%2099.5%20240.5t241%2099.5Zm-.5-340Z'/%3e%3c/svg%3e",Zo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M559-97q-18%2018-43.5%2018T472-97L97-472q-10-10-13.5-21T80-516v-304q0-26%2017-43t43-17h304q12%200%2024%203.5t22%2013.5l373%20373q19%2019%2019%2044.5T863-401L559-97Zm-41-41%20304-304-378-378H140v304l378%20378ZM245-664q21%200%2036.5-15.5T297-716q0-21-15.5-36.5T245-768q-21%200-36.5%2015.5T193-716q0%2021%2015.5%2036.5T245-664ZM140-820Z'/%3e%3c/svg%3e",mt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M480-160q-133%200-226.5-93.5T160-480q0-133%2093.5-226.5T480-800q85%200%20149%2034.5T740-671v-129h60v254H546v-60h168q-38-60-97-97t-137-37q-109%200-184.5%2075.5T220-480q0%20109%2075.5%20184.5T480-220q83%200%20152-47.5T728-393h62q-29%20105-115%20169t-195%2064Z'/%3e%3c/svg%3e",Vo={class:"loading-popout"},jo={class:"bar",id:"bar"},Ko=A({__name:"LoadingProgressPopout",props:{text:{default:"Progress: "},perc:{}},setup(r){const t=r,e=T(()=>({width:t.perc*120+"px"}));return(n,o)=>(g(),b("div",Vo,[a("label",null,I(t.text),1),a("div",jo,[a("div",{class:"bar",id:"barCurrent",style:J(e.value)},null,4)])]))}}),Go=E(Ko,[["__scopeId","data-v-30a64108"]]),Qo=A({__name:"Plot3d",props:{data:{}},setup(r,{expose:t}){const e=w(null),n=r,o=T(()=>n.data.map(h=>({x:h.x,y:h.y,z:h.z,mode:"markers",type:"scatter3d",hoverinfo:"text",hoverlabel:{bgcolor:"#181818",font:{color:"white"}},text:h.text,marker:{size:3.5,opacity:h.opacity,color:h.color}}))),l={autosize:!0,margin:{l:0,r:0,b:0,t:0},showlegend:!1,scene:{xaxis:{title:"",showticklabels:!1,tickfont:{size:10}},yaxis:{title:"",showticklabels:!1,tickfont:{size:10}},zaxis:{title:"",showticklabels:!1,tickfont:{size:10}}},paper_bgcolor:"#f6f6f6",plot_bgcolor:"#f6f6f6"},s={...l,paper_bgcolor:"#151515",plot_bgcolor:"#151515",font:{color:"white"}},d=w(K.isDarkMode()?"dark":"light");K.registerThemeChangeCallback(()=>{d.value=K.isDarkMode()?"dark":"light",c()});const i=T(()=>d.value==="dark"?s:l),p={modeBarButtonsToRemove:["toImage","sendDataToCloud","resetCameraLastSave3d","resetCameraDefault3d"],displaylogo:!1,responsive:!0};let y=null;function c(){if(!e.value)return;qe.react(e.value,o.value,i.value,p),e.value.layout.scene&&y&&qe.relayout(e.value,"scene.camera",y)}return t({update:c}),ke(()=>{qe.newPlot(e.value,o.value,i.value,p).then(()=>{e.value.on("plotly_relayout",u=>{if(console.log("plotly_relayout",u),!u["scene.camera"])return;const m=u["scene.camera"];y=Se(m)})}),e.value.on("plotly_click",function(u){u.points||console.log("Not clicking on any data.");const m=u.points[0].x,h=u.points[0].y,f=u.points[0].z,v=u.points[0].pointNumber;console.log(`You clicked on ${m}, ${h}, ${f} (point ${v})}`)}),ae(o,()=>{c()})}),(u,m)=>(g(),b("div",{id:"ploty-chart",ref_key:"plotlyChart",ref:e},null,512))}}),Jo=E(Qo,[["__scopeId","data-v-e21cc654"]]),Yo=r=>(X("data-v-8c794e78"),r=r(),ee(),r),Xo={id:"main-filtervis"},es=["open"],ts=Yo(()=>a("summary",null,"Visualization",-1)),as={id:"plot3dDiv"},ns={key:0,id:"loadingDiv",class:"full"},os={key:1,class:"status"},ss=A({__name:"FilterVis",setup(r){const t=W(),e=w(null),n=M(),o=V(),l=w(null),s=T(()=>{if(l.value===null)return{};const u=Object.keys(t.database.data),m={};for(const h of u)l.value[h]&&(m[h]=l.value[h]);return m});function d(u,m="rgb(100, 100, 200)"){const h=s.value;if(!h)u=[];else for(let $=u.length-1;$>=0;$--)h[u[$]]===void 0&&u.splice($,1);const f=u.length,v=new Float32Array(f),_=new Float32Array(f),k=new Float32Array(f),S=new Array(f);for(const[$,U]of u.entries()){let B=h[U];if(B==null)throw new Error("uid not found in feats: "+U);v[$]=B[0],_[$]=B[1],k[$]=B[2];const j=t.database.get(U);S[$]=`${j.authorYear()}<br>${j.summary.title}`}let C;if(typeof m=="string")C=m;else if(m instanceof Array)if(typeof m[0]=="string")C=m;else{const $=m,U=Math.max(...$),B=Math.min(...$),j={0:K.isDarkMode()?[50,50,50]:[220,220,220],1:[50,200,150]};C=$.map(N=>{const P=(N-B)/(U-B),z=Array(3);for(let ce=0;ce<3;ce++)z[ce]=Math.round(j[0][ce]*(1-P)+j[1][ce]*P);return`rgb(${z[0]}, ${z[1]}, ${z[2]})`})}else throw new Error("Invalid color type");return{x:v,y:_,z:k,opacity:.75,color:C,text:S}}const i=T(()=>{const u=n.shownDataScores;let m;u?m=d(Se(n.shownDataUIDs),u):m=d(Se(n.shownDataUIDs));const f=Object.keys(t.database.data).filter(k=>n.shownDataUIDs.indexOf(k)==-1),v=d(f,K.isDarkMode()?"rgb(50, 50, 50)":"rgb(220, 220, 220)"),_=d(Se(n.unfoldedDataUIDs),"rgb(255, 0, 0)");return[m,v,_]}),p=T(()=>Object.keys(s.value).length>0);async function y(){l.value=null;const u=(await new q().status()).n_data;let m;u<50?m=-1:u<100?m=5:u<300?m=8:u<500?m=12:m=15,console.log("dataset size: ",u,"perp: ",m),new q().reqDatabaseFeatureTSNE("doc_feature",3,m).then(h=>{l.value=h})}function c(u){u.target instanceof HTMLDetailsElement&&(u.target.open?(o.setShow3DScatterPlot(!0),y()):o.setShow3DScatterPlot(!1))}return(u,m)=>(g(),b("div",Xo,[a("details",{onToggle:c,open:x(o).show3DScatterPlot},[ts,a("div",as,[D(Jo,{data:i.value,ref_key:"plot3DRef",ref:e},null,8,["data"]),p.value?F("",!0):(g(),b("div",ns,[l.value===null?(g(),G(Le,{key:0})):(g(),b("p",os,"Data not ready"))]))])],40,es)]))}}),rs=E(ss,[["__scopeId","data-v-8c794e78"]]),ls=r=>(X("data-v-c80b02b9"),r=r(),ee(),r),is={id:"bannerAddons"},us={class:"searchbar"},ds=["value"],cs={id:"main-home",class:"gradIn"},ps={class:"horizontal fullHeight"},hs={key:0,id:"left-panel"},ms={id:"right-panel",class:"panel1"},fs={class:"fullWidth"},vs={class:"scrollable",id:"fileSelector"},gs={key:1,id:"blankPlaceholder"},ys={key:0,style:{"font-size":"xx-large","font-weight":"bold","user-select":"none"}},_s={style:{"font-size":"medium"}},ws=ls(()=>a("br",null,null,-1)),bs={name:"Home",inheritAttrs:!1,customOptions:{}},ks=A({...bs,setup(r){const t=M(),e=W(),n=V();window.innerWidth<768&&n.setShowTagPanel(!1);const l=fe().currentRoute.value.query.tags;l!=null&&(t.tagStatus.checked=new O(l.split("&&")),t.tagStatus.unfolded=t.tagStatus.checked.allParents());const s=["general","title","author","note","publication","feature","uuid"],d=w(""),i=w(null);function p(){const m={searchBy:i.value.value,content:d.value};t.searchState=m,console.log(m),t.updateShownData()}const y=rt(p,200),c=w(!1);function u(){t.reloadDatabase(),Ue().reset()}return(m,h)=>(g(),b(H,null,[D(pt,{datapoint:null,show:c.value,"onUpdate:show":h[0]||(h[0]=f=>c.value=f)},null,8,["show"]),D(xe,{"return-home":!1},{default:R(()=>[a("div",is,[D(re,{iconSrc:x(Wo),labelText:"New",title:"Add new data to database",onClick:h[1]||(h[1]=f=>c.value=!0),shortcut:"ctrl+n"},null,8,["iconSrc"]),D(re,{"icon-src":x(Zo),"label-text":"Tags",title:"Tag utilities",onClick:h[2]||(h[2]=()=>x(n).setShowTagPanel(!x(n).showTagPanel))},null,8,["icon-src"]),D(re,{iconSrc:x(mt),labelText:"Reload",title:"Reload database",onClick:u},null,8,["iconSrc"]),L(" | "),a("div",us,[a("select",{ref_key:"searchSelector",ref:i,name:"search_type",id:"searchType",onChange:p},[(g(),b(H,null,Y(s,f=>a("option",{value:f},I(f),9,ds)),64))],544),Z(a("input",{id:"searchbar",type:"text","onUpdate:modelValue":h[3]||(h[3]=f=>d.value=f),onInput:h[4]||(h[4]=(...f)=>x(y)&&x(y)(...f)),placeholder:"search"},null,544),[[Q,d.value]])])])]),_:1}),a("div",cs,[a("div",ps,[D($e,{name:"left-in"},{default:R(()=>[x(n).showTagPanel?(g(),b("div",hs,[D(Sa,{onOnCheck:h[5]||(h[5]=()=>x(t).updateShownData())})])):F("",!0)]),_:1}),a("div",ms,[a("div",fs,[D(rs)]),a("div",vs,[x(t).shownDataUIDs.length>0?(g(),G(De,{key:0,datapoints:x(e).database.getMany(x(t).shownDataUIDs),unfoldedIds:x(t).unfoldedDataUIDs,"onUpdate:unfoldedIds":h[6]||(h[6]=f=>x(t).unfoldedDataUIDs=f)},null,8,["datapoints","unfoldedIds"])):(g(),b("div",gs,[x(e).database.initialized?(g(),b("p",ys,[L(" Nothing to show "),a("p",_s,[L(" Add your first enty by clicking the "),a("b",null,[a("a",{onClick:h[7]||(h[7]=f=>c.value=!0),style:{cursor:"pointer","border-radius":"5px","padding-inline":"3px","background-color":"var(--color-background-soft)"}},"⊕ New")]),L(" button above."),ws])])):(g(),G(Le,{key:1}))])),D($e,{name:"fade"},{default:R(()=>[x(e).database.initialized?F("",!0):(g(),G(Go,{key:0,perc:x(t).databaseLoadingProgress,text:x(t).databaseLoadingStatus.nTotal>=0?`${x(t).databaseLoadingStatus.nCurrent} / ${x(t).databaseLoadingStatus.nTotal}`:"_"},null,8,["perc","text"]))]),_:1})])])])])],64))}}),Ss=E(ks,[["__scopeId","data-v-c80b02b9"]]),ft=r=>(X("data-v-87dd0856"),r=r(),ee(),r),$s={id:"authorPapers"},Cs={id:"tag-selector"},Ds={id:"feed-main",class:"slideInFast"},xs={class:"articleBlock"},Ts={class:"titleBlock"},Is={class:"titleId"},Ps={class:"authors"},Us=ft(()=>a("label",null,"[Authors] ",-1)),Ls={class:"authorSpan"},Bs=["onClick"],As=["onClick"],qs={key:1},Rs={class:"actions"},Ms=ft(()=>a("summary",null,"Abstract",-1)),Es={id:"relatedArticles"},Os=A({__name:"ArticleBlock",props:{article:{}},setup(r){const t=r,e=W(),n=w(!1),o=w(null),l=T({set:f=>{f&&(o.value={all:new O(M().tagStatus.all),checked:new O,unfolded:new O}),n.value=f},get:()=>n.value});function s(){var _;const f=ct(t.article),v=(_=o.value)==null?void 0:_.checked;new q().editData(null,f,Array.from(v||[]),t.article.link).then(()=>{M().showPopup(`collected ${t.article.id}`,"success")},()=>M().showPopup(`failed to collect ${t.article.id}, check log for details`,"warning"))}function d(f){const v=e.authorPublicationMap;return f=be(f),f in v?v[f].length:null}const i=w(!1),p=w([]);function y(f){f=be(f),console.log("check publication of author: ",f),p.value=e.authorPublicationMap[f],i.value=!0}const c=w([]),u=w([]),m=T(()=>{const f={};for(let v=0;v<c.value.length;v++)f[c.value[v].summary.uuid]=u.value[v].toPrecision(4);return f});function h(){c.value.length>0||new q().search("searchFeature",{pattern:t.article.abstract,n_return:8}).then(f=>{var S;const v=new Array,_=new Array;for(const C of Object.keys(f))v.push((S=f[C])==null?void 0:S.score),_.push(C);const k=ze.sortByScore(_,v);c.value=k[0].map(C=>e.database.get(C)),u.value=k[1]})}return(f,v)=>(g(),b(H,null,[D(Ce,{show:i.value,"onUpdate:show":v[0]||(v[0]=_=>i.value=_),title:"Publications in the database",onOnClose:v[1]||(v[1]=_=>p.value=[])},{default:R(()=>[a("div",$s,[D(De,{datapoints:p.value},null,8,["datapoints"])])]),_:1},8,["show"]),D(he,{show:l.value,"onUpdate:show":v[3]||(v[3]=_=>l.value=_),title:`Adding ${t.article.id}`,onOnAccept:v[4]||(v[4]=()=>{s(),l.value=!1}),onOnCancel:v[5]||(v[5]=()=>l.value=!1)},{default:R(()=>[a("div",Cs,[D(dt,{tagStatus:o.value,"onUpdate:tagStatus":v[2]||(v[2]=_=>o.value=_)},null,8,["tagStatus"])])]),_:1},8,["show","title"]),a("div",Ds,[a("div",xs,[a("div",Ts,[a("h2",null,I(t.article.title),1),a("label",Is,I(t.article.id),1)]),a("div",Ps,[Us,(g(!0),b(H,null,Y(t.article.authors,(_,k)=>(g(),b("span",Ls,[a("a",{onClick:()=>x(Pe)(`https://arxiv.org/search/?query=${_}&searchtype=author`)},I(_),9,Bs),d(_)?(g(),b("a",{key:0,class:"pubCount",onClick:()=>y(_)},I(` (${d(_)})`),9,As)):F("",!0),k<t.article.authors.length-1?(g(),b("span",qs,", ")):F("",!0)]))),256))]),a("div",Rs,[a("a",{onClick:v[6]||(v[6]=()=>x(Pe)(`https://arxiv.org/abs/${f.article.id}`))},"Arxiv"),L(" | "),a("a",{onClick:v[7]||(v[7]=()=>x(Pe)(`https://arxiv.org/pdf/${f.article.id}.pdf`))},"PDF"),L(" | "),a("a",{onClick:v[8]||(v[8]=()=>l.value=!0)},"Collect")]),a("p",null,"Published: "+I(t.article.publishedTime),1),a("details",null,[Ms,a("p",null,I(t.article.abstract),1)]),a("details",null,[a("summary",{onClick:h},"Related articles"),a("div",Es,[D(De,{datapoints:c.value,scores:m.value},null,8,["datapoints","scores"])])])])])],64))}}),zs=E(Os,[["__scopeId","data-v-87dd0856"]]),Te=r=>(X("data-v-267cdb79"),r=r(),ee(),r),Fs={id:"banner"},Ns={id:"main"},Hs=["src"],Ws={id:"settings"},Zs=Te(()=>a("option",{value:"cat:cs.CV OR cat:cs.AI OR stat.ML"},"ALL",-1)),Vs=Te(()=>a("option",{value:"cat:cs.CV"},"cs.CV",-1)),js=Te(()=>a("option",{value:"cat:cs.AI"},"cs.AI",-1)),Ks=Te(()=>a("option",{value:"cat:stat.ML"},"stat.ML",-1)),Gs=[Zs,Vs,js,Ks],Qs={key:0,id:"loadingPlaceholder"},Js=Te(()=>a("b",null,"Fetching...",-1)),Ys=A({__name:"Feed",setup(r){const t=new q,e=w("cat:cs.CV OR cat:cs.AI OR stat.ML"),n=w(""),o=w(null),l=w([]),s=T(function(){return[...l.value].sort((f,v)=>{if(o.value===null||!f.features||!v.features)return 0;{const _=f.features,k=v.features,S=o.value,C=_.reduce((U,B,j)=>U+(B-S[j])**2,0),$=k.reduce((U,B,j)=>U+(B-S[j])**2,0);return C-$}})});function d(){if(n.value.trim()===""){o.value=null;return}new q().featurize(n.value).then(h=>{o.value=new Float32Array(h)},()=>{console.log("failed to featurize")})}const i=rt(d,100),p=fe();let y=parseInt(p.currentRoute.value.query.maxResults)||100;y>200&&(window.alert("maxResults cannot be larger than 200"),y=200);let c=p.currentRoute.value.query.search||"";c!==""&&(n.value=c);const u=w(null);async function m(){l.value=[];const h=await Va(y,e.value);console.log(`Got ${h.length} entries.`);for(const f of h){const v=f;v.features=w(null),l.value.push(v),t.featurize(f.abstract,!0).then(_=>{v.features.value=new Float32Array(_)},()=>{console.log("failed to featurize: ",f.id)})}d()}return ke(()=>{m().then(()=>u.value.classList.remove("spin"),()=>{u.value.classList.remove("spin"),window.alert("Failed to fetch articles")})}),(h,f)=>(g(),b(H,null,[a("div",Fs,[D(xe,{ref:"banner"},null,512)]),a("div",Ns,[a("h1",null,[L(" Arxiv daily "),a("img",{ref_key:"refreshButton",ref:u,src:x(mt),alt:"",class:"icon spin",title:"refresh the page",onClick:f[0]||(f[0]=v=>{const _=v.target;_.classList.contains("spin")||(_.classList.add("spin"),m().then(()=>_.classList.remove("spin")))})},null,8,Hs)]),a("div",Ws,[Z(a("select",{name:"category",id:"category-select","onUpdate:modelValue":f[1]||(f[1]=v=>e.value=v),onChange:m},Gs,544),[[Ct,e.value]]),Z(a("input",{type:"text",placeholder:"Search",onInput:f[2]||(f[2]=(...v)=>x(i)&&x(i)(...v)),"onUpdate:modelValue":f[3]||(f[3]=v=>n.value=v),autocomplete:"off"},null,544),[[Q,n.value]])]),s.value.length===0?(g(),b("div",Qs,[Js,D(Le)])):F("",!0),(g(!0),b(H,null,Y(s.value,v=>(g(),G(zs,{article:v},null,8,["article"]))),256))])],64))}}),Xs=E(Ys,[["__scopeId","data-v-267cdb79"]]),vt=r=>(X("data-v-d701bc0b"),r=r(),ee(),r),er={class:"main"},tr={id:"login",class:"slideIn"},ar={class:"loginLine"},nr={class:"loginLine"},or=["type"],sr=vt(()=>a("summary",null,"Settings",-1)),rr={id:"settings"},lr=vt(()=>a("label",{for:"backendHostInput"},"Backend: ",-1)),ir={class:"options"},ur={key:0,class:"error"},dr=A({__name:"LoginInput",setup(r){const t=w(""),e=w(""),n=w(""),o=w(!0),l=w(!1),s=T(()=>l.value?"text":"password"),d=w("Login"),i=fe(),p=w(""),y=w("");i.isReady().then(()=>{Dt(()=>{p.value=V().backendHost,y.value=V().backendPort})});function c(){V().setBackendHost(p.value),V().setBackendPort(y.value),d.value="Connecting...";const u=jt(t.value,e.value);new q().authUsr(u).then(h=>{Fe(u,h,o.value),n.value="";const f=i.currentRoute.value.query.from;f?(console.log("Redirecting to",f),i.push(f)):i.push("/"),d.value="Login"},h=>{n.value=h,d.value="Login"})}return(u,m)=>(g(),b("div",er,[a("div",tr,[a("form",null,[a("div",ar,[Z(a("input",{class:"key-input",type:"text",id:"username-input","onUpdate:modelValue":m[0]||(m[0]=h=>t.value=h),placeholder:"Username",autocomplete:"off"},null,512),[[Q,t.value]])]),a("div",nr,[Z(a("input",{class:"key-input",type:s.value,id:"password-input","onUpdate:modelValue":m[1]||(m[1]=h=>e.value=h),placeholder:"Password"},null,8,or),[[xt,e.value]])]),a("details",null,[sr,a("div",rr,[lr,Z(a("input",{type:"text",id:"backendHostInput","onUpdate:modelValue":m[2]||(m[2]=h=>p.value=h)},null,512),[[Q,p.value]]),L(" : "),Z(a("input",{type:"text",id:"port","onUpdate:modelValue":m[3]||(m[3]=h=>y.value=h)},null,512),[[Q,y.value]]),a("div",ir,[D(pe,{checked:o.value,onOnCheck:m[4]||(m[4]=()=>{o.value=!o.value})},{default:R(()=>[L("Stay login")]),_:1},8,["checked"]),D(pe,{checked:l.value,onOnCheck:m[5]||(m[5]=()=>{l.value=!l.value})},{default:R(()=>[L("Show key")]),_:1},8,["checked"])])])]),a("button",{type:"submit",onClick:Tt(c,["prevent"])},I(d.value),1)]),n.value?(g(),b("p",ur,I(n.value),1)):F("",!0)])]))}}),cr=E(dr,[["__scopeId","data-v-d701bc0b"]]),pr={id:"main"},hr={id:"container"},mr={for:"login",id:"info"},fr=["href"],vr=A({__name:"Login",setup(r){K.setDefaultDarkMode();function t(){alert(`Not implemented yet. 
Please contact the maintainer for registration.`)}return(e,n)=>(g(),b("div",pr,[a("div",hr,[D(cr),a("label",mr,[L(" Need assistant? - "),a("a",{onClick:t},"Register"),L(" | "),a("a",{href:`mailto:${x(Ot).email}`},"Contact me",8,fr)])])]))}}),gr=E(vr,[["__scopeId","data-v-a2e2514f"]]);class yr{constructor(t){se(this,"router");this.router=t}getURLParams(){const t={},e=this.router.currentRoute.value.query;for(const n in e)t[n]=e[n];return t}setURLParam(t,e){const n=this.getURLParams();n[t]=e,this.router.push({query:n})}updateURLWithParam(t,e){const n=this.getURLParams();return n[t]=e,this.router.resolve({query:n}).href}}function _r(r,{router:t=null,datapoint:e=null}){const n=t?new yr(t):null;return e&&(r=r.replace(new RegExp("./misc/","g"),`${te()}/img/${e.summary.uuid}\\?fname=`),n&&(window.location.href.includes("/reader/")?r=r.replace(new RegExp("\\$\\{doc\\}#","g"),n.updateURLWithParam("docHashMark","")):r=r.replace(new RegExp("\\$\\{doc\\}#","g"),`${e.getOpenDocURL()}#`))),r}const wr={id:"noteEditor"},br=A({__name:"NoteEditor",props:{datapoint:{},theme:{default:"light"}},setup(r,{expose:t}){const e=r,n=fe(),o=w(""),l=T(()=>_r(o.value,{router:n,datapoint:e.datapoint})),s=w(null);function d(){e.datapoint.fetchNote().then(c=>{console.log("Note fetched"),o.value=c,c.trim().length>0&&(y.value=!0)},c=>{console.error(c)})}d(),ae(()=>e.datapoint,()=>{d(),console.log("datapoint changed, fetching note")});function i(){e.datapoint.uploadNote(o.value).then(()=>{console.log("Note saved"),M().showPopup("Note saved","success")},c=>{console.error(c),M().showPopup("Failed to save","warning")})}const p=async c=>{e.datapoint.uploadImages(c).then(u=>{console.log("Images uploaded"),u.map(m=>s.value.insert(()=>({targetValue:`![image](${m})`,select:!1,deviationStart:0,deviationEnd:0}))),i()},u=>{console.error(u)})},y=w(!1);return t({preview:y,fetchNote:d}),(c,u)=>(g(),b("div",wr,[a("div",{class:"editor",onDblclick:u[1]||(u[1]=m=>y.value=!1)},[y.value?(g(),G(x(At),{key:1,"model-value":l.value,theme:c.theme},null,8,["model-value","theme"])):(g(),G(x(Bt),{key:0,ref_key:"mdEditor",ref:s,modelValue:o.value,"onUpdate:modelValue":u[0]||(u[0]=m=>o.value=m),preview:!1,language:"en-US",theme:c.theme,onOnSave:i,onOnUploadImg:p,toolbars:["bold","underline","italic","-","strikeThrough","title","quote","unorderedList","orderedList","task","-","link","-","revoke","next","save","=","catalog"]},null,8,["modelValue","theme"]))],32)]))}}),kr=E(br,[["__scopeId","data-v-d1883f51"]]),Sr={id:"body"},$r=["src"],Cr=A({__name:"ReaderBody",props:{datapoint:{},layoutType:{}},setup(r,{expose:t}){const e=r,n=fe(),o=T(()=>{const k=n.currentRoute.value.query.docHashMark;return k||""}),l=w(null),s=w(null),d=w(null),i=w(!1),p=w(null);t({noteEditor:p});function y(_){d.value&&d.value.contains(_.target)&&(i.value=!0)}function c(){i.value=!1}const u=T({get:()=>M().preferredReaderLeftPanelWidthPerc,set:_=>{M().preferredReaderLeftPanelWidthPerc=_}});function m(_){if(i.value&&l.value&&s.value&&d.value){const S=("touches"in _?_.touches[0].clientX:_.clientX)-l.value.getBoundingClientRect().left;l.value.style.width=`${S}px`,s.value.style.width=`calc(100% - ${S}px)`,u.value=S/(S+s.value.getBoundingClientRect().width),u.value=Math.max(.1,Math.min(.9,u.value))}}window.addEventListener("mousedown",y),window.addEventListener("touchstart",y),window.addEventListener("mouseup",c),window.addEventListener("touchend",c),window.addEventListener("mousemove",m),window.addEventListener("touchmove",m);function h(_){_==0?(l.value.style.width="100%",s.value.style.width="0%"):_==1?(l.value.style.width="0%",s.value.style.width="100%"):_==2&&(l.value.style.width=`${u.value*100}%`,s.value.style.width=`${(1-u.value)*100}%`),V().setReaderLayoutType(_)}ae(()=>e.layoutType,(_,k)=>{console.log("layoutType changed:",k,"->",_),h(_)});const f=w(K.isDarkMode()?"dark":"light");K.registerThemeChangeCallback(()=>f.value=K.isDarkMode()?"dark":"light");const v=T(()=>`${e.datapoint.getOpenDocURL({extraPDFViewerParams:{"color-mode":f.value},urlHashMark:o.value})}`);return ke(()=>{h(e.layoutType)}),(_,k)=>(g(),b("div",Sr,[a("div",{class:"pane",id:"left-pane",ref_key:"leftPane",ref:l},[a("iframe",{src:v.value,title:"doc",frameborder:"0",style:J({"pointer-events":i.value?"none":"auto"})},null,12,$r)],512),_.layoutType==2?(g(),b("div",{key:0,id:"splitter",ref_key:"splitter",ref:d,onMousedown:y,onTouchstart:y},null,544)):F("",!0),a("div",{class:"pane",id:"right-pane",ref_key:"rightPane",ref:s},[D(kr,{datapoint:_.datapoint,theme:f.value,ref_key:"noteEditor",ref:p},null,8,["datapoint","theme"])],512)]))}}),Dr=E(Cr,[["__scopeId","data-v-312e7b1f"]]),xr="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M180-120q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H180Zm390%200q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H570Zm210-660H570v600h210v-600ZM570-180h210-210Z'/%3e%3c/svg%3e",Tr="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M220-160q-24%200-42-18t-18-42v-143h60v143h520v-143h60v143q0%2024-18%2042t-42%2018H220Zm230-153v-371L330-564l-43-43%20193-193%20193%20193-43%2043-120-120v371h-60Z'/%3e%3c/svg%3e",Ir="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M480.118-330Q551-330%20600.5-379.618q49.5-49.617%2049.5-120.5Q650-571%20600.382-620.5q-49.617-49.5-120.5-49.5Q409-670%20359.5-620.382q-49.5%2049.617-49.5%20120.5Q310-429%20359.618-379.5q49.617%2049.5%20120.5%2049.5Zm-.353-58Q433-388%20400.5-420.735q-32.5-32.736-32.5-79.5Q368-547%20400.735-579.5q32.736-32.5%2079.5-32.5Q527-612%20559.5-579.265q32.5%2032.736%2032.5%2079.5Q592-453%20559.265-420.5q-32.736%2032.5-79.5%2032.5ZM480-200q-146%200-264-83T40-500q58-134%20176-217t264-83q146%200%20264%2083t176%20217q-58%20134-176%20217t-264%2083Zm0-300Zm-.169%20240Q601-260%20702.5-325.5%20804-391%20857-500q-53-109-154.331-174.5-101.332-65.5-222.5-65.5Q359-740%20257.5-674.5%20156-609%20102-500q54%20109%20155.331%20174.5%20101.332%2065.5%20222.5%2065.5Z'/%3e%3c/svg%3e",Pr={id:"bannerOps"},Ur={id:"recently-read"},Lr={id:"main-reader",class:"gradIn"},Br={name:"Reader",inheritAttrs:!1,customOptions:{}},Ar=A({...Br,setup(r){const t=W(),e=M(),n=nt(),o=fe(),l=T(()=>n.params.id),s=w(t.database.get(l.value));ae(()=>n.params.id,()=>{s.value=t.database.get(n.params.id),d()});function d(){e.addRecentlyReadDataUID(l.value)}d();const i=T(()=>{const _=[];for(const k of e.recentlyReadDataUIDs){if(k===n.params.id)continue;const S=t.database.get(k);_.push({name:S.authorYear(),action:()=>{o.push("/reader/"+k)}})}return _}),p=w(V().readerLayoutType);window.innerWidth<800&&(p.value=0);function y(){if(window.innerWidth<800)p.value=(p.value+1)%2;else switch(p.value){case 0:p.value=2;break;case 1:p.value=2;break;case 2:p.value=0;break}}const c=w(null);function u(_){function k(){s.value.uploadDocument(_).then(S=>{s.value.update(S),e.showPopup("Document uploaded","success")},()=>e.showPopup("Failed to upload document","error"))}s.value.summary.has_file?s.value.freeDocument().then(S=>{s.value.update(S),k()},()=>e.showPopup("Failed to free document","error")):k()}const m=w(null),h=T(()=>{try{return m.value.noteEditor.preview}catch{return!1}}),f=T(()=>h.value?"edit":"preview");function v(){m.value.noteEditor.preview=!m.value.noteEditor.preview}return ke(()=>{if(Object.keys(t.database.data).length===0){M().showPopup("Database not loaded or empty database.","alert");const _=setInterval(()=>{M().showPopup("Trying to update datapoint...","warning",2e3),Object.keys(t.database.data).length!==0&&(clearInterval(_),s.value=t.database.get(l.value),M().showPopup("Datapoint updated.","success",3e3))},750)}}),(_,k)=>(g(),b(H,null,[D(x(Be),{action:u,ref_key:"fileSelectionBtn",ref:c,style:{display:"none"}},null,512),D(xe,null,{default:R(()=>[a("div",Pr,[D(re,{iconSrc:x(xr),labelText:"layout",shortcut:"ctrl+r",onOnClick:y,title:"change layout"},null,8,["iconSrc"]),D(re,{iconSrc:x(Tr),labelText:"upload",shortcut:"ctrl+u",onOnClick:k[0]||(k[0]=()=>c.value.click()),title:"upload a new document"},null,8,["iconSrc"]),D(re,{iconSrc:x(Ir),labelText:f.value,shortcut:"ctrl+p",onOnClick:v,title:"preview or edit markdown note"},null,8,["iconSrc","labelText"]),D(x(ht),{"menu-items":i.value},{default:R(()=>[a("div",Ur,I(`${s.value.authorAbbr()} (${s.value.summary.year})`),1)]),_:1},8,["menu-items"])])]),_:1}),a("div",Lr,[D(Dr,{datapoint:s.value,layoutType:p.value,ref_key:"readerBody",ref:m},null,8,["datapoint","layoutType"])])],64))}}),qr=E(Ar,[["__scopeId","data-v-6e064c89"]]),le=r=>(X("data-v-67668231"),r=r(),ee(),r),Rr={class:"banner"},Mr={id:"about-main",class:"slideIn"},Er=le(()=>a("h1",null,"About",-1)),Or={id:"about-div",class:"content"},zr=le(()=>a("br",null,null,-1)),Fr=le(()=>a("a",{href:"https://github.com/MenxLi/Lires",target:"_blank"},"GitHub - MenxLi/Lires",-1)),Nr=le(()=>a("br",null,null,-1)),Hr=["href"],Wr=le(()=>a("b",null,"Server status: ",-1)),Zr=le(()=>a("b",null,"Backend",-1)),Vr=le(()=>a("b",null,"Version",-1)),jr=le(()=>a("b",null,"Uptime",-1)),Kr=le(()=>a("b",null,"Number of documents",-1)),Gr=le(()=>a("b",null,"Number of connections",-1)),Qr={id:"versionHistory",class:"content"},Jr={class:"block"},Yr={key:0},Xr={key:1},el=A({__name:"About",setup(r){const t=w([]),e=w(!1),n=()=>{new q().changelog().then(p=>{t.value=p},p=>{console.error(p)})},o=w(-1),l=T(()=>{if(o.value===-1)return"N/A";const p=Math.floor(o.value/3600),y=Math.floor((o.value-p*3600)/60),c=Math.floor(o.value-p*3600-y*60);return`${p}h ${y}m ${c}s`}),s=w({backend:te(),version:"",uptime:l,_uptime:-1,numDocs:-1,numConnections:-1}),d=()=>{new q().status().then(p=>{o.value=p.uptime,s.value.version=p.version,s.value.numDocs=p.n_data,s.value.numConnections=p.n_connections},p=>{console.error(p)})},i=T(()=>t.value.slice().reverse());return n(),d(),window.setInterval(()=>o.value++,1e3),ne("login",()=>s.value.numConnections++),ne("logout",()=>s.value.numConnections--),(p,y)=>(g(),b(H,null,[a("div",Rr,[D(xe)]),a("div",Mr,[Er,a("div",Or,[a("p",null,[L(" Lires is a self-hosted web application for research literature management. "),zr,L(" It is open source and available at "),Fr,L(". "),Nr,L(" The user manual is available at "),a("a",{href:x(Et),target:"_blank"},"here",8,Hr),L(". ")]),a("p",null,[Wr,a("ul",null,[a("li",null,[Zr,L(": "+I(s.value.backend),1)]),a("li",null,[Vr,L(": "+I(s.value.version),1)]),a("li",null,[jr,L(": "+I(s.value.uptime),1)]),a("li",null,[Kr,L(": "+I(s.value.numDocs),1)]),a("li",null,[Gr,L(": "+I(s.value.numConnections),1)])])]),a("a",{onClick:y[0]||(y[0]=c=>e.value=!0),style:{cursor:"pointer"}},"View change log")]),D(Ce,{show:e.value,"onUpdate:show":y[1]||(y[1]=c=>e.value=c),title:"Change log"},{default:R(()=>[a("div",Qr,[(g(!0),b(H,null,Y(i.value.length,c=>(g(),b("div",Jr,[a("h2",null,I(i.value[c-1][0].toString()),1),a("ul",null,[(g(!0),b(H,null,Y(i.value[c-1][1],u=>(g(),b("li",null,[typeof u=="string"?(g(),b("div",Yr,I(u),1)):typeof u=="object"?(g(),b("div",Xr,[L(I(Object.keys(u)[0])+" ",1),a("ul",null,[(g(!0),b(H,null,Y(u[Object.keys(u)[0]],m=>(g(),b("li",null,I(m),1))),256))])])):F("",!0)]))),256))])]))),256))])]),_:1},8,["show"])])],64))}}),tl=E(el,[["__scopeId","data-v-67668231"]]),al={},nl={id:"widget-container-main"};function ol(r,t){return g(),b("div",nl,[me(r.$slots,"default",{},void 0,!0)])}const et=E(al,[["render",ol],["__scopeId","data-v-257ac3c4"]]),sl="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120q-33%200-56.5-23.5T120-200v-560q0-33%2023.5-56.5T200-840h357l-80%2080H200v560h560v-278l80-80v358q0%2033-23.5%2056.5T760-120H200Zm280-360ZM360-360v-170l367-367q12-12%2027-18t30-6q16%200%2030.5%206t26.5%2018l56%2057q11%2012%2017%2026.5t6%2029.5q0%2015-5.5%2029.5T897-728L530-360H360Zm481-424-56-56%2056%2056ZM440-440h56l232-232-28-28-29-28-231%20231v57Zm260-260-29-28%2029%2028%2028%2028-28-28Z'/%3e%3c/svg%3e",gt=r=>(X("data-v-649783dd"),r=r(),ee(),r),rl={id:"usercard-main"},ll={id:"user-settings"},il=gt(()=>a("hr",null,null,-1)),ul=gt(()=>a("summary",null,"Change password",-1)),dl={id:"password-container"},cl={id:"info"},pl={id:"user-desc"},hl={id:"name-edit"},ml={id:"name"},fl=["src"],vl={key:0,class:"admin_hint"},gl={id:"backendurl"},yl=A({__name:"UserCard",props:{userInfo:{}},emits:["update:userInfo"],setup(r,{emit:t}){const e=r,n=t,o=T(()=>W().user.id===e.userInfo.id),l=w(null),s=T(()=>(console.log("avatarURL updated"),`${te()}/user-avatar/${e.userInfo.username}?t=${Date.now()}&size=256`));function d(h){if(!h.type.startsWith("image/")){M().showPopup("Please select an image file","error");return}M().showPopup("Uploading avatar..."),new q().uploadUserAvatar(e.userInfo.username,h).then(f=>{n("update:userInfo",f)},f=>{M().showPopup(f,"error")})}const i=w(!1),p=w(""),y=w(""),c=w(""),u=w("");function m(){if(p.value===""||p.value===e.userInfo.name||p.value!==e.userInfo.name&&new q().updateUserNickname(p.value).then(h=>{n("update:userInfo",h),i.value=!1},h=>{M().showPopup(h,"error")}),c.value!==""||u.value!==""){if(c.value===""){M().showPopup("Please enter the new password","error");return}if(c.value!==u.value){M().showPopup("The new passwords do not match","error");return}if(V().encKey!==ue(e.userInfo.username+ue(y.value))){M().showPopup("The old password is incorrect","error");return}new q().updateUserPassword(c.value).then(h=>{const f=ue(e.userInfo.username+ue(c.value));V().setEncKey(f,!0),y.value="",c.value="",u.value="",i.value=!1},h=>{M().showPopup(h,"error")})}}return(h,f)=>(g(),b("div",rl,[D(he,{show:i.value,"onUpdate:show":f[4]||(f[4]=v=>i.value=v),title:"User settings",onOnCancel:f[5]||(f[5]=v=>i.value=!1),onOnAccept:m},{default:R(()=>[a("div",ll,[a("b",null,I(e.userInfo.username),1),Z(a("input",{type:"text","onUpdate:modelValue":f[0]||(f[0]=v=>p.value=v),placeholder:"Nickname",class:"input"},null,512),[[Q,p.value]]),il,a("details",null,[ul,a("div",dl,[Z(a("input",{type:"password","onUpdate:modelValue":f[1]||(f[1]=v=>y.value=v),placeholder:"Old password",class:"input"},null,512),[[Q,y.value]]),Z(a("input",{type:"password","onUpdate:modelValue":f[2]||(f[2]=v=>c.value=v),placeholder:"New password",class:"input"},null,512),[[Q,c.value]]),Z(a("input",{type:"password","onUpdate:modelValue":f[3]||(f[3]=v=>u.value=v),placeholder:"Confirm new password",class:"input"},null,512),[[Q,u.value]])])])])]),_:1},8,["show"]),a("div",cl,[a("div",{id:"avatar",style:J(o.value?{cursor:"pointer",borderRadius:"50%"}:{})},[D(x(Cn),{href:s.value,size:"168px",onClick:f[6]||(f[6]=v=>{var _;return o.value?(_=l.value)==null?void 0:_.click():()=>{}})},null,8,["href"]),D(x(Be),{text:"Change avatar",action:d,ref_key:"avatarUploadBtn",ref:l,style:{display:"none"}},null,512)],4),a("div",pl,[a("div",hl,[a("h1",ml,I(e.userInfo.name),1),o.value?(g(),b("img",{key:0,src:x(sl),alt:"",class:"icon",id:"edit-settings-icon",onClick:f[7]||(f[7]=v=>i.value=!0)},null,8,fl)):F("",!0)]),a("p",null,[L(I(e.userInfo.username)+" ",1),e.userInfo.is_admin?(g(),b("label",vl,"admin")):F("",!0)]),a("p",gl,I(x(te)()),1)])])]))}}),_l=E(yl,[["__scopeId","data-v-649783dd"]]),wl="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M160-400v-80h280v80H160Zm0-160v-80h440v80H160Zm0-160v-80h440v80H160Zm360%20560v-123l221-220q9-9%2020-13t22-4q12%200%2023%204.5t20%2013.5l37%2037q8%209%2012.5%2020t4.5%2022q0%2011-4%2022.5T863-380L643-160H520Zm300-263-37-37%2037%2037ZM580-220h38l121-122-18-19-19-18-122%20121v38Zm141-141-19-18%2037%2037-18-19Z'/%3e%3c/svg%3e",ie=r=>(X("data-v-a2cb77d9"),r=r(),ee(),r),bl={id:"users-widget-main"},kl={id:"user-editor-main"},Sl={class:"horizontal"},$l=["src"],Cl={id:"user-editor"},Dl={class:"horizontal"},xl={class:"horizonal"},Tl={class:"full-width left-align"},Il=ie(()=>a("b",null,"Mandatory Tags:",-1)),Pl={id:"delete-user-dialog-main"},Ul={id:"create-user-table"},Ll=ie(()=>a("td",null,"Username:",-1)),Bl=ie(()=>a("td",null,"Name:",-1)),Al=ie(()=>a("td",null,"Password:",-1)),ql=ie(()=>a("td",null,"Mandatory Tags:",-1)),Rl={colspan:"2"},Ml={id:"user-widget-header"},El=ie(()=>a("div",null,[a("b",null," Users ")],-1)),Ol={key:0},zl=ie(()=>a("th",null," Avatar ",-1)),Fl=ie(()=>a("th",null," Username ",-1)),Nl=ie(()=>a("th",null," Name ",-1)),Hl=ie(()=>a("th",null," Accessibility ",-1)),Wl={class:"user-line"},Zl={key:0},Vl=["onClick"],jl=["src"],Kl={class:"center full-width full-height"},Gl=["src"],Ql={class:"username"},Jl={key:1,class:"admin_hint"},Yl={key:0,colspan:"5"},Xl=A({__name:"UsersWidget",setup(r){const t=w([]),e=T(()=>W().user.is_admin),n=w(!1),o=w({});function l(S){if(!e.value)return;const C=JSON.parse(JSON.stringify(S));o.value=C,n.value=!0}function s(S){const C=S.split(";").map($=>$.trim());C.length===1&&C[0]===""?o.value.mandatory_tags=[]:o.value.mandatory_tags=C}function d(){console.log(o.value),new q().setUserAccess(o.value.username,o.value.is_admin,o.value.mandatory_tags).then(S=>{n.value=!1},S=>{console.log(S),M().showPopup(S,"error")})}const i=w(!1),p=w("");function y(){if(p.value!==o.value.username){M().showPopup("Wrong input","error");return}new q().deleteUser(o.value.username).then(S=>{M().showPopup(`User ${o.value.username} deleted`,"info"),i.value=!1,n.value=!1},S=>{console.log(S),M().showPopup(S,"error")})}const c=w(!1),u=w(""),m=w(Ie[Math.floor(Math.random()*Ie.length)]),h=w(""),f=w(!1),v=w("");function _(){c.value=!1,u.value="",m.value=Ie[Math.floor(Math.random()*Ie.length)],h.value="",f.value=!1,v.value=""}function k(){if(u.value===""){M().showPopup("Please enter the username","error");return}const S=v.value.split(";").map(C=>C.trim());S.length===1&&S[0]===""&&S.splice(0,1),new q().createUser(u.value,m.value,h.value,f.value,S).then(C=>{M().showPopup(`User ${u.value} created`,"success"),_()},C=>{console.log(C),M().showPopup(C,"error")})}return ke(()=>{new q().reqUserList().then(S=>{t.value=S},S=>{console.log(S)})}),ne("add_user",S=>{const C=S.user_info;t.value.push(C)}),ne("update_user",S=>{const C=S.user_info;t.value.map(($,U)=>{$.id===C.id&&(t.value[U]=C)})}),ne("delete_user",S=>{const C=S.username;t.value=t.value.filter($=>$.username!==C)}),(S,C)=>(g(),b("div",bl,[D(he,{show:n.value,"onUpdate:show":C[3]||(C[3]=$=>n.value=$),title:"editor",onOnAccept:d,onOnCancel:C[4]||(C[4]=()=>n.value=!1)},{default:R(()=>[a("div",kl,[a("div",Sl,[a("img",{src:`${x(te)()}/user-avatar/${o.value.username}?size=128`,alt:"",class:"avatar-big"},null,8,$l),a("div",Cl,[a("div",Dl,[a("h2",null,I(o.value.name),1),L(" ("+I(o.value.username)+") ",1)]),a("div",xl,[D(pe,{checked:o.value.is_admin,onOnCheck:C[0]||(C[0]=()=>{o.value.is_admin=!o.value.is_admin})},{default:R(()=>[L(" Administrator")]),_:1},8,["checked"])]),a("div",Tl,[Il,a("div",{id:"mandatory-tag-edit",class:ve(o.value.is_admin?"mute":"")},[D(x(We),{style:{width:"100%"},"content-editable":!o.value.is_admin,onFinish:C[1]||(C[1]=$=>s($))},{default:R(()=>[L(I(o.value.mandatory_tags.join("; ")),1)]),_:1},8,["content-editable"])],2)])])]),a("input",{id:"delete-user-button",type:"button",value:"Delete user",onClick:C[2]||(C[2]=()=>{i.value=!0})})])]),_:1},8,["show"]),D(he,{show:i.value,"onUpdate:show":C[6]||(C[6]=$=>i.value=$),title:"Delete user",onOnCancel:C[7]||(C[7]=()=>i.value=!1),onOnAccept:y},{default:R(()=>[a("div",Pl,[a("p",null,[L(" Are you sure to delete user "),a("b",null,I(o.value.name)+" ("+I(o.value.username)+")",1),L("? ")]),L(" Type "),a("b",null,I(o.value.username),1),L(" to confirm: "),Z(a("input",{type:"text",id:"delete-user-input","onUpdate:modelValue":C[5]||(C[5]=$=>p.value=$),autocomplete:"off"},null,512),[[Q,p.value]])])]),_:1},8,["show"]),D(he,{show:c.value,"onUpdate:show":C[13]||(C[13]=$=>c.value=$),onOnCancel:_,onOnAccept:k,onOnClose:_},{default:R(()=>[a("table",Ul,[a("tr",null,[Ll,a("td",null,[Z(a("input",{type:"text","onUpdate:modelValue":C[8]||(C[8]=$=>u.value=$),autocomplete:"off",class:"create-user-input"},null,512),[[Q,u.value]])])]),a("tr",null,[Bl,a("td",null,[Z(a("input",{type:"text","onUpdate:modelValue":C[9]||(C[9]=$=>m.value=$),autocomplete:"off",class:"create-user-input"},null,512),[[Q,m.value]])])]),a("tr",null,[Al,a("td",null,[Z(a("input",{type:"text","onUpdate:modelValue":C[10]||(C[10]=$=>h.value=$),autocomplete:"off",class:"create-user-input"},null,512),[[Q,h.value]])])]),a("tr",null,[ql,a("td",null,[Z(a("input",{type:"text","onUpdate:modelValue":C[11]||(C[11]=$=>v.value=$),autocomplete:"off",class:"create-user-input",placeholder:"Separate with semicolon ';'"},null,512),[[Q,v.value]])])]),a("tr",null,[a("td",Rl,[D(pe,{checked:f.value,onOnCheck:C[12]||(C[12]=()=>{f.value=!f.value})},{default:R(()=>[L(" Administrator")]),_:1},8,["checked"])])])])]),_:1},8,["show"]),a("div",Ml,[El,e.value?(g(),b("div",{key:0,id:"add-user-div",onClick:C[14]||(C[14]=()=>c.value=!0)},"+")):F("",!0)]),a("table",null,[a("tr",null,[e.value?(g(),b("th",Ol)):F("",!0),zl,Fl,Nl,Hl]),(g(!0),b(H,null,Y(t.value,$=>(g(),b("tr",Wl,[e.value?(g(),b("td",Zl,[a("div",{class:"edit-button",onClick:()=>l($)},[a("img",{src:x(wl),alt:"",class:"icon"},null,8,jl)],8,Vl)])):F("",!0),a("td",null,[a("div",Kl,[a("img",{src:`${x(te)()}/user-avatar/${$.username}?size=60`,alt:"",class:"avatar"},null,8,Gl)])]),a("td",Ql,I($.username),1),a("td",null,I($.name),1),a("td",null,[$.is_admin?(g(),b("label",Jl,"ADMIN")):(g(),G(ut,{key:0,tags:$.mandatory_tags,"max-width":200,"middle-align":!0},null,8,["tags"]))])]))),256)),a("tr",null,[t.value.length===0?(g(),b("td",Yl," No users ")):F("",!0)])])]))}}),ei=E(Xl,[["__scopeId","data-v-a2cb77d9"]]),ti={id:"main-dashboard",class:"slideIn"},ai=A({__name:"Dashboard",setup(r){const t=nt(),e=new q,n=T(()=>W().user.id===o.value.id),o=w({id:0,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1});function l(){e.reqUserInfo(t.params.username).then(s=>{o.value=s},s=>{M().showPopup(s,"error")})}return Me(l),window.onhashchange=l,ne("update_user",s=>{s.username===o.value.username&&l()}),(s,d)=>(g(),b(H,null,[D(xe),a("div",ti,[D(et,null,{default:R(()=>[D(_l,{"user-info":o.value},null,8,["user-info"])]),_:1}),D(et,null,{default:R(()=>[n.value?(g(),G(ei,{key:0})):F("",!0)]),_:1})])],64))}}),ni=E(ai,[["__scopeId","data-v-bc23120b"]]),oi={class:"editor-block"},si={class:"editor-toolbar"},ri={id:"editor-body"},li={key:0,id:"editor-input",class:"body-area"},ii={key:1,id:"editor-preview",class:"body-area"},ui=["innerHTML"],di=A({__name:"EditorBlock",props:je({preRenderFn:{type:Function,default:r=>r},theme:{default:"light"}},{text:{default:""},textModifiers:{},preview:{type:Boolean,default:!1},previewModifiers:{}}),emits:je(["on-input","on-save","on-upload-images"],["update:text","update:preview"]),setup(r,{emit:t}){const e=r,n=Ke(r,"text"),o=Ke(r,"preview"),l=w(e.preRenderFn(n.value));ae(()=>n.value,i=>{l.value=qt().render(e.preRenderFn(i))});const s=t;function d(i){s("on-upload-images",[i])}return(i,p)=>(g(),b("div",oi,[a("div",si,[a("button",{onClick:p[0]||(p[0]=y=>s("on-save",n.value))},"Save"),a("button",{onClick:p[1]||(p[1]=y=>o.value=!o.value)},"Toggle Preview"),D(x(Be),{action:d})]),a("div",ri,[o.value?(g(),b("div",ii,[a("div",{innerHTML:l.value},null,8,ui)])):(g(),b("div",li,[Z(a("textarea",{"onUpdate:modelValue":p[2]||(p[2]=y=>n.value=y),onInput:p[3]||(p[3]=y=>s("on-input",n.value))},null,544),[[Q,n.value]])]))])]))}}),ci=E(di,[["__scopeId","data-v-16bcc29f"]]),pi={key:0,class:"test"},hi={key:1,style:{"text-align":"center","margin-top":"20px"}},mi=A({__name:"_Test",setup(r){const e=w(""),n=w(!1);function o(){console.log("Note saved")}const l=async s=>{console.log("Images uploaded",s)};return(s,d)=>x(!1)?(g(),b("div",pi,[D(ci,{text:e.value,"onUpdate:text":d[0]||(d[0]=i=>e.value=i),preview:n.value,"onUpdate:preview":d[1]||(d[1]=i=>n.value=i),onOnSave:o,onOnUploadImages:l},null,8,["text","preview"])])):(g(),b("p",hi," Test is not available in production "))}}),fi=[{path:"/",component:Ss},{path:"/feed",component:Xs},{path:"/login",component:gr},{path:"/reader/:id",component:qr},{path:"/about",component:tl},{path:"/dashboard/:username",component:ni},{path:"/_test",component:mi}],vi=Ut({history:Lt(),routes:fi}),gi=Pt();It(sa).use(gi).use(vi).mount("#app");
