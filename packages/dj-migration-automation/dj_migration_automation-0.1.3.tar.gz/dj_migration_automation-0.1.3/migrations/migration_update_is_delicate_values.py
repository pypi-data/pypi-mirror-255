from peewee import DoesNotExist

from dosepack.base_model.base_model import db, BaseModel
from model.model_init import init_db



import settings
from src.model.model_unique_drug import UniqueDrug


def update_is_delicate_for_given_fndc_txr():
    init_db(db, "database_migration")
    print("Migration start :update values for is delicate for given drugs")
    fndc_txr_list = [(9045604, 68644), (9046997, 3005), (9046998, 3009), (9046999, 3011), (307680156, 2173),
                     (333420111, 37003), (409850274, 2173), (409850274, 64176), (516724041, 4559), (546290909, 12016),
                     (578960752, 48770), (602580162, 33515), (683820106, 4537), (321212, 65329), (323016, 70893),
                     (935417, 53994), (936450, 47525), (2450108, 1646), (3783815, 53995), (3786689, 27462),
                     (5361232, 4381), (5740608, 62753), (8325324, 22345), (8325325, 22346), (9044040, 4380),
                     (9046412, 2689), (9046748, 2947), (9046751, 16995), (9046783, 16995), (293000138, 4538),
                     (293000139, 4539), (293000140, 4540), (317220712, 39545), (333420084, 45191), (333420085, 47285),
                     (333420111, 37003), (516724041, 4559), (519910772, 30107), (551110399, 30107), (551110645, 43137),
                     (572370017, 57891), (572370018, 57892), (572370019, 57893), (597460030, 51800), (597460050, 59403),
                     (605050015, 16849), (605050145, 43136), (605053275, 45190), (605053276, 45191), (605053277, 47285),
                     (605053278, 47286), (614420103, 8374), (627560796, 4538), (627560797, 4539), (681800294, 57891),
                     (681800297, 74166), (683820106, 4537), (700000419, 4380), (707000150, 33530), (542531, 4002),
                     (930752, 5139), (932210, 2766), (933213, 4562), (935417, 53994), (937201, 16367), (1431771, 507),
                     (1723927, 3766), (1724096, 4679), (1724097, 4680), (2231760, 1226), (2282077, 3690),
                     (2282128, 347), (2282129, 348), (2282540, 2539), (3100095, 66612), (3780018, 50631),
                     (3780032, 5132), (3780214, 3975), (3780218, 15864), (3780257, 3973), (3780757, 5138),
                     (3781300, 4004), (3782402, 3853), (3783815, 53995), (3786231, 46206), (5271313, 21731),
                     (5361047, 2661), (5910444, 364), (5910453, 11984), (5915335, 4581), (5915337, 4582),
                     (5915554, 5123), (6030209, 78687), (8320111, 27637), (8325324, 22345), (9045307, 11583),
                     (9046412, 2689), (9046717, 17037), (9046730, 4490), (9047591, 1645), (100060730, 2427),
                     (100060730, 2337), (131070032, 46452), (131070156, 46224), (136680008, 19188), (167290005, 16578),
                     (167290090, 41440), (167290096, 62749), (167290097, 62750), (167290141, 13648), (167290170, 50760),
                     (167290173, 46047), (167290175, 46044), (167290182, 28915), (167290183, 8182), (167290201, 47644),
                     (205550001, 2148), (231550001, 284), (231550002, 286), (231550621, 27508), (293000114, 22551),
                     (293000130, 29832), (307680194, 61738), (317220531, 21408), (317220536, 44632), (317220538, 45652),
                     (333420084, 45191), (333420111, 37003), (409850271, 16248), (409850274, 64176), (425430493, 4575),
                     (425710315, 17026), (435470275, 29335), (435470356, 392), (435470403, 8210), (435470406, 4560),
                     (435980164, 27961), (435980166, 27960), (458020650, 18698), (459630677, 16600), (459630709, 47586),
                     (498840065, 4887), (498840122, 5098), (498840290, 8829), (501110560, 46241), (501110561, 46242),
                     (516724038, 387), (516724039, 384), (516724041, 4559), (519910293, 27779), (528170319, 27229),
                     (537460544, 4544), (551110167, 41026), (551110718, 65251), (572370175, 46401), (576640394, 46400),
                     (605050065, 33530), (605050141, 1777), (605050142, 1776), (605050146, 43137), (605052579, 29968),
                     (605052580, 29969), (605052656, 8176), (605052657, 8177), (605052806, 58487), (605053276, 45191),
                     (605053277, 47285), (625590292, 65955), (627560142, 46754), (627560260, 45100), (627560430, 4003),
                     (627560796, 4538), (627560798, 4540), (646790926, 386), (649800340, 24053), (651620897, 52898),
                     (658620193, 46214), (658620194, 46215), (658620598, 27546), (658620847, 46416), (678770223, 21414),
                     (678770242, 34187), (678770246, 34189), (678770249, 60292), (678770250, 34188), (681800320, 53007),
                     (681800468, 6460), (681800469, 6461), (681800479, 16578), (681800512, 17266), (681800513, 393),
                     (681800519, 388), (681800965, 6648), (681800967, 6650), (681800969, 6651), (681800971, 6653),
                     (681800981, 391), (683820008, 17871), (683820009, 22550), (683820093, 28109), (683820114, 21154),
                     (683820116, 21156), (683820139, 26169), (683820182, 27378), (683820662, 6816), (683820775, 36872),
                     (683820799, 5099), (684620189, 8361), (690970126, 16925), (690970128, 16927), (690970158, 29156),
                     (690970159, 29157), (690970821, 6416), (692381313, 57802), (692381837, 20176), (693150116, 8208),
                     (693150117, 8209), (693150127, 2366), (693150136, 4589), (693150137, 4590), (693150138, 4591),
                     (693150905, 3758), (693150906, 3759), (709540005, 4929), (709540020, 292), (806810097, 2455),
                     (806810098, 2451), (806810132, 64302), (806810139, 58018), (806810148, 24665), (806810169, 28465),
                     (9046998, 3009), (5970164, 73433), (806810072, 2341), (501110450, 46243), (5910795, 4924),
                     (605051323, 49758), (707101209, 2535), (333420054, 42943), (5550607, 8829), (623320020, 3714),
                     (681800979, 392), (597625007, 15197), (658620860, 11678), (578960634, 1408), (806810165, 2339),
                     (167290044, 29967), (1151012, 4680), (709540276, 3824), (678770563, 40974), (646790925, 384),
                     (477810654, 6652), (576640808, 4521), (507420176, 17297), (528170325, 50491), (3786689, 27462),
                     (678770561, 13318), (435470272, 43202), (1850676, 3732), (167290455, 6654), (502280458, 2538),
                     (681800353, 46229), (293000139, 4539), (707000150, 33530), (678770248, 60293), (605050183, 4558),
                     (167290456, 6655), (5361327, 4489), (692382078, 5124), (700000419, 4380), (167290137, 4561),
                     (293000128, 8182), (576640347, 13649), (692382079, 5125), (692382077, 5123), (8321550, 3974),
                     (576640345, 13648), (933426, 3758), (167290447, 6648), (167290448, 6649), (572370008, 46450),
                     (8321540, 3977), (681800377, 23382), (681800376, 23381), (333420071, 41026), (633040828, 29968),
                     (678770431, 52898), (658620666, 51336), (710930127, 29335), (937202, 20741), (933212, 4561),
                     (930832, 4560), (512240007, 46754)]
    formatted_list = [(str(x).zfill(9), str(y)) if len(str(x)) != 9 else (str(x), str(y)) for x, y in
                      fndc_txr_list]
    try:

        with db.transaction():

            for item in formatted_list:
                try:
                    update_status = UniqueDrug.update(is_delicate=True).where(
                        UniqueDrug.formatted_ndc == item[0], UniqueDrug.txr == item[1]).execute()
                except DoesNotExist as e:
                   raise e


    except Exception as e:
        print("error", e)


if __name__ == "__main__":
    update_is_delicate_for_given_fndc_txr()

    print("is delicate updated")
